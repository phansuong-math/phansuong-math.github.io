<html lang="vi" class="fontawesome-i2svg-active fontawesome-i2svg-complete"><head><script>(function(firebaseConfig, appId) {
        window.__firebase_config = firebaseConfig;
        window.__app_id = appId;
            })("\n{\n  \"apiKey\": \"AIzaSyB0CNdoLDZU9pF5CPHuVGMrWnAdzQSZcgo\",\n  \"authDomain\": \"thuan10vectors.firebaseapp.com\",\n  \"projectId\": \"thuan10vectors\",\n  \"storageBucket\": \"thuan10vectors.firebasestorage.app\",\n  \"messagingSenderId\": \"965608552389\",\n  \"appId\": \"1:965608552389:web:2064690144d13ff9b1bdac\"\n}\n","TroChoiVecto_Full_16h11")</script><script>'use strict';var h=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,b,d){if(a==Array.prototype||a==Object.prototype)return a;a[b]=d.value;return a};function l(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var d=a[b];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");}var n=l(this);
function p(a,b){if(b)a:{var d=n;a=a.split(".");for(var c=0;c<a.length-1;c++){var e=a[c];if(!(e in d))break a;d=d[e]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&b!=null&&h(d,a,{configurable:!0,writable:!0,value:b})}}function r(a){function b(c){return a.next(c)}function d(c){return a.throw(c)}return new Promise(function(c,e){function f(g){g.done?c(g.value):Promise.resolve(g.value).then(b,d).then(f,e)}f(a.next())})}function t(a){return r(a())}
p("Object.values",function(a){return a?a:function(b){var d=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&d.push(b[c]);return d}});p("Array.prototype.includes",function(a){return a?a:function(b,d){var c=this;c instanceof String&&(c=String(c));var e=c.length;d=d||0;for(d<0&&(d=Math.max(d+e,0));d<e;d++){var f=c[d];if(f===b||Object.is(f,b))return!0}return!1}});/*

 MIT License

 Copyright (c) 2017-2023 W.Y.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 SOFTWARE.

*/
function u(a,b){const d=a.style;b.backgroundColor&&(d.backgroundColor=b.backgroundColor);b.width&&(d.width=`${b.width}px`);b.height&&(d.height=`${b.height}px`);const c=b.style;c!=null&&Object.keys(c).forEach(e=>{d[e]=c[e]})};var v=(()=>{let a=0;return()=>{a+=1;return`u${`0000${(Math.random()*1679616<<0).toString(36)}`.slice(-4)}${a}`}})();function w(a){const b=[];for(let d=0,c=a.length;d<c;d++)b.push(a[d]);return b}let x=null;function y(a={}){return x?x:a.l?x=a.l:x=w(window.getComputedStyle(document.documentElement))}function z(a,b){return(a=(a.ownerDocument.defaultView||window).getComputedStyle(a).getPropertyValue(b))?parseFloat(a.replace("px","")):0}
function A(a,b={}){var d;if(!(d=b.width)){d=z(a,"border-left-width");var c=z(a,"border-right-width");d=a.clientWidth+d+c}(b=b.height)||(b=z(a,"border-top-width"),c=z(a,"border-bottom-width"),b=a.clientHeight+b+c);return{width:d,height:b}}function B(a){return new Promise((b,d)=>{const c=new Image;c.onload=()=>{c.decode().then(()=>{requestAnimationFrame(()=>b(c))})};c.onerror=d;c.crossOrigin="anonymous";c.decoding="async";c.src=a})}
function C(a){return t(function*(){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(a)).then(encodeURIComponent).then(b=>`data:image/svg+xml;charset=utf-8,${b}`)})}
function D(a,b,d){return t(function*(){const c=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");c.setAttribute("width",`${b}`);c.setAttribute("height",`${d}`);c.setAttribute("viewBox",`0 0 ${b} ${d}`);e.setAttribute("width","100%");e.setAttribute("height","100%");e.setAttribute("x","0");e.setAttribute("y","0");e.setAttribute("externalResourcesRequired","true");c.appendChild(e);e.appendChild(a);return C(c)})}
var E=(a,b)=>{if(a instanceof b)return!0;a=Object.getPrototypeOf(a);return a===null?!1:a.constructor.name===b.name||E(a,b)};function F(a,b){return y(b).map(d=>{const c=a.getPropertyValue(d),e=a.getPropertyPriority(d);return`${d}: ${c}${e?" !important":""};`}).join(" ")}
function G(a,b,d,c){a=window.getComputedStyle(a,d);var e=a.getPropertyValue("content");if(e!==""&&e!=="none"){var f=v();try{b.className=`${b.className} ${f}`}catch(k){return}e=document.createElement("style");var g=e.appendChild;d=`.${f}:${d}`;a.cssText?(c=a.getPropertyValue("content"),c=`${a.cssText} content: '${c.replace(/'|"/g,"")}';`):c=F(a,c);g.call(e,document.createTextNode(`${d}{${c}}`));b.appendChild(e)}};function H(a){return a.search(/^(data:)/)!==-1}function I(a,b,d){return t(function*(){const c=yield fetch(a,b);if(c.status===404)throw Error(`Resource "${c.url}" not found`);const e=yield c.blob();return new Promise((f,g)=>{const k=new FileReader;k.onerror=g;k.onloadend=()=>{try{f(d({o:c,result:k.result}))}catch(m){g(m)}};k.readAsDataURL(e)})})}const J={};function K(a,b,d){let c=a.replace(/\?.*/,"");d&&(c=a);/ttf|otf|eot|woff2?/i.test(c)&&(c=c.replace(/.*\//,""));return b?`[${b}]${c}`:c}
function L(a,b,d){return t(function*(){const c=K(a,b,d.C);if(J[c]!=null)return J[c];d.u&&(a+=(/\?/.test(a)?"&":"?")+(new Date).getTime());let e;try{const f=yield I(a,d.i,({o:g,result:k})=>{b||(b=g.headers.get("Content-Type")||"");return k.split(/,/)[1]});e=`data:${b};base64,${f}`}catch(f){e=d.B||""}return J[c]=e})};const M={P:"application/font-woff",R:"application/font-woff",N:"application/font-truetype",v:"application/vnd.ms-fontobject",H:"image/png",F:"image/jpeg",D:"image/jpeg",A:"image/gif",M:"image/tiff",L:"image/svg+xml",O:"image/webp"};function N(a){return(a=/\.([^./]*?)$/g.exec(a))?a[1]:""};function O(a){return t(function*(){const b=a.toDataURL();return b==="data:,"?a.cloneNode(!1):B(b)})}function aa(a,b){return t(function*(){if(a.currentSrc){var d=document.createElement("canvas");const c=d.getContext("2d");d.width=a.clientWidth;d.height=a.clientHeight;c==null||c.drawImage(a,0,0,d.width,d.height);d=d.toDataURL();return B(d)}d=a.poster;d=yield L(d,M[N(d).toLowerCase()]||"",b);return B(d)})}
function ba(a,b){return t(function*(){try{let d;if(a==null?0:(d=a.contentDocument)==null?0:d.body)return yield P(a.contentDocument.body,b,!0)}catch(d){}return a.cloneNode(!1)})}function ca(a,b){return t(function*(){return E(a,HTMLCanvasElement)?O(a):E(a,HTMLVideoElement)?aa(a,b):E(a,HTMLIFrameElement)?ba(a,b):a.cloneNode(a.tagName!=null&&a.tagName.toUpperCase()==="SVG")})}
function da(a,b,d){return t(function*(){if(b.tagName!=null&&b.tagName.toUpperCase()==="SVG")return b;let c=[];if(a.tagName!=null&&a.tagName.toUpperCase()==="SLOT"&&a.assignedNodes)c=w(a.assignedNodes());else{let e;if(E(a,HTMLIFrameElement)&&((e=a.contentDocument)==null?0:e.body))c=w(a.contentDocument.body.childNodes);else{let f;c=w(((f=a.shadowRoot)!=null?f:a).childNodes)}}if(c.length===0||E(a,HTMLVideoElement))return b;yield c.reduce((e,f)=>e.then(()=>P(f,d)).then(g=>{g&&b.appendChild(g)}),Promise.resolve());
return b})}function ea(a,b,d){const c=b.style;if(c){var e=window.getComputedStyle(a);e.cssText?(c.cssText=e.cssText,c.transformOrigin=e.transformOrigin):y(d).forEach(f=>{let g=e.getPropertyValue(f);f==="font-size"&&g.endsWith("px")&&(g=`${Math.floor(parseFloat(g.substring(0,g.length-2)))-.1}px`);E(a,HTMLIFrameElement)&&f==="display"&&g==="inline"&&(g="block");f==="d"&&b.getAttribute("d")&&(g=`path(${b.getAttribute("d")})`);c.setProperty(f,g,e.getPropertyPriority(f))})}}
function fa(a,b){E(a,HTMLSelectElement)&&(b=Array.from(b.children).find(d=>a.value===d.getAttribute("value")))&&b.setAttribute("selected","")}
function ha(a,b){return t(function*(){var d=a.querySelectorAll?a.querySelectorAll("use"):[];if(d.length===0)return a;var c={};for(var e=0;e<d.length;e++){var f=d[e].getAttribute("xlink:href");if(f){const g=document.querySelector(f);a.querySelector(f)||!g||c[f]||(c[f]=yield P(g,b,!0))}}d=Object.values(c);if(d.length){c=document.createElementNS("http://www.w3.org/1999/xhtml","svg");c.setAttribute("xmlns","http://www.w3.org/1999/xhtml");c.style.position="absolute";c.style.width="0";c.style.height="0";
c.style.overflow="hidden";c.style.display="none";e=document.createElementNS("http://www.w3.org/1999/xhtml","defs");c.appendChild(e);for(f=0;f<d.length;f++)e.appendChild(d[f]);a.appendChild(c)}return a})}
function P(a,b,d){return t(function*(){return d||!b.filter||b.filter(a)?Promise.resolve(a).then(c=>ca(c,b)).then(c=>da(a,c,b)).then(c=>{E(c,Element)&&(ea(a,c,b),G(a,c,":before",b),G(a,c,":after",b),E(a,HTMLTextAreaElement)&&(c.textContent=a.value),E(a,HTMLInputElement)&&c.setAttribute("value",a.value),fa(a,c));return c}).then(c=>ha(c,b)):null})};const Q=/url\((['"]?)([^'"]+?)\1\)/g,ia=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,ja=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ka(a){const b=[];a.replace(Q,(d,c,e)=>{b.push(e);return d});return b.filter(d=>!H(d))}
function la(a,b,d,c){return t(function*(){try{const e=d?(new URL(b,d||void 0)).toString():b;let f;f=yield L(e,M[N(b).toLowerCase()]||"",c);return a.replace(new RegExp(`(url\\(['"]?)(${b.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")})(['"]?\\))`,"g"),`$1${f}$3`)}catch(e){}return a})}function ma(a,{I:b}){return b?a.replace(ja,d=>{for(;;){const [c,,e]=ia.exec(d)||[],f=c,g=e;if(!g)return"";if(g===b)return`src: ${f};`}}):a}
function R(a,b,d){return t(function*(){if(a.search(Q)===-1)return a;const c=ma(a,d);return ka(c).reduce((e,f)=>e.then(g=>la(g,f,b,d)),Promise.resolve(c))})};function S(a,b,d){return t(function*(){var c;const e=(c=b.style)==null?void 0:c.getPropertyValue(a);return e?(c=yield R(e,null,d),b.style.setProperty(a,c,b.style.getPropertyPriority(a)),!0):!1})}function na(a,b){return t(function*(){(yield S("background",a,b))||(yield S("background-image",a,b));(yield S("mask",a,b))||(yield S("-webkit-mask",a,b))||(yield S("mask-image",a,b))||(yield S("-webkit-mask-image",a,b))})}
function oa(a,b){return t(function*(){const d=E(a,HTMLImageElement);if(d&&!H(a.src)||E(a,SVGImageElement)&&!H(a.href.baseVal)){var c=d?a.src:a.href.baseVal,e=yield L(c,M[N(c).toLowerCase()]||"",b);yield new Promise((f,g)=>{a.onload=f;a.onerror=b.m?(...k)=>{try{f(b.m(...k))}catch(m){g(m)}}:g;a.decode&&(a.decode=f);a.loading==="lazy"&&(a.loading="eager");d?(a.srcset="",a.src=e):a.href.baseVal=e})}})}
function pa(a,b){return t(function*(){const d=w(a.childNodes).map(c=>T(c,b));yield Promise.all(d).then(()=>a)})}function T(a,b){return t(function*(){E(a,Element)&&(yield na(a,b),yield oa(a,b),yield pa(a,b))})};const U={};function V(a){return t(function*(){var b=U[a];if(b!=null)return b;b=yield(yield fetch(a)).text();b={url:a,cssText:b};return U[a]=b})}function W(a,b){return t(function*(){let d=a.cssText;const c=/url\(["']?([^"')]+)["']?\)/g,e=(d.match(/url\([^)]+\)/g)||[]).map(f=>t(function*(){let g=f.replace(c,"$1");g.startsWith("https://")||(g=(new URL(g,a.url)).href);return I(g,b.i,({result:k})=>{d=d.replace(f,`url(${k})`);return[f,k]})}));return Promise.all(e).then(()=>d)})}
function X(a){if(a==null)return[];const b=[];a=a.replace(/(\/\*[\s\S]*?\*\/)/gi,"");for(var d=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");;){var c=d.exec(a);if(c===null)break;b.push(c[0])}a=a.replace(d,"");d=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi;for(c=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");;){let e=d.exec(a);if(e===null)if(e=c.exec(a),e===null)break;else d.lastIndex=c.lastIndex;else c.lastIndex=
d.lastIndex;b.push(e[0])}return b}
function qa(a,b){return t(function*(){const d=[],c=[];a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach((f,g)=>{if(f.type===CSSRule.IMPORT_RULE){let k=g+1;f=V(f.href).then(m=>W(m,b)).then(m=>X(m).forEach(q=>{try{e.insertRule(q,q.startsWith("@import")?k+=1:e.cssRules.length)}catch(Da){}})).catch(()=>{});c.push(f)}})}catch(f){const g=a.find(k=>k.href==null)||document.styleSheets[0];e.href!=null&&c.push(V(e.href).then(k=>W(k,b)).then(k=>X(k).forEach(m=>{g.insertRule(m,g.cssRules.length)})).catch(()=>
{}))}});return Promise.all(c).then(()=>{a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach(f=>{d.push(f)})}catch(f){}});return d})})}function ra(a){return a.filter(b=>b.type===CSSRule.FONT_FACE_RULE).filter(b=>b.style.getPropertyValue("src").search(Q)!==-1)}function sa(a,b){return t(function*(){if(a.ownerDocument==null)throw Error("Provided element is not within a Document");var d=w(a.ownerDocument.styleSheets);d=yield qa(d,b);return ra(d)})}
function ta(a){function b(c){(c.style.fontFamily||getComputedStyle(c).fontFamily).split(",").forEach(e=>{d.add(e.trim().replace(/["']/g,""))});Array.from(c.children).forEach(e=>{e instanceof HTMLElement&&b(e)})}const d=new Set;b(a);return d}function ua(a,b){return t(function*(){const d=yield sa(a,b),c=ta(a);return(yield Promise.all(d.filter(e=>c.has(e.style.fontFamily.trim().replace(/["']/g,""))).map(e=>R(e.cssText,e.parentStyleSheet?e.parentStyleSheet.href:null,b)))).join("\n")})}
function va(a,b){return t(function*(){const d=b.j!=null?b.j:b.K?null:yield ua(a,b);if(d){const c=document.createElement("style");c.appendChild(document.createTextNode(d));a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)}})};function wa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b),e=yield P(a,b,!0);yield va(e,b);yield T(e,b);u(e,b);return yield D(e,d,c)})}
function xa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b);var e=yield wa(a,b);e=yield B(e);const f=document.createElement("canvas"),g=f.getContext("2d"),k=b.G||window.devicePixelRatio||1,m=b.h||d,q=b.g||c;f.width=m*k;f.height=q*k;!b.J&&(f.width>16384||f.height>16384)&&(f.width>16384&&f.height>16384?f.width>f.height?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=16384):f.width>16384?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=
16384));f.style.width=`${m}`;f.style.height=`${q}`;b.backgroundColor&&(g.fillStyle=b.backgroundColor,g.fillRect(0,0,f.width,f.height));g.drawImage(e,0,0,f.width,f.height);return f})}function ya(a,b={}){return t(function*(){return(yield xa(a,b)).toDataURL()})};const za=["gemini.google.com","corp.google.com","proxy.googlers.com"];function Y(){return document.body.querySelectorAll('[class*="animate"]').length>0}function Z(a){return t(function*(){try{return yield ya(a,{h:a.offsetWidth,g:a.offsetHeight})}catch(d){var b=a.offsetHeight;const c=document.createElement("canvas");c.width=a.offsetWidth;c.height=b;return c.toDataURL("image/png")}})}
function Aa(){return t(function*(){const a=document.body.offsetWidth,b=document.body.offsetHeight,d=document.body.cloneNode(!0);d.querySelectorAll('[class*="animate"]').forEach(c=>{c.classList.remove(...Array.from(c.classList).filter(e=>e.startsWith("animate")))});d.style.width=`${a}px`;d.style.height=`${b}px`;return d})}
function Ba(a){return t(function*(){let b=document.body;if(Y()){var d=yield Aa();b=d;document.body.appendChild(d)}d=yield Z(b);Y()&&document.body.removeChild(b);window.parent.postMessage({type:"SEND_SCREENSHOT",image:d,topOffset:document.documentElement.scrollTop},a.origin)})}function Ca(a){return t(function*(){const b={type:"SEND_SCREENSHOT_FOR_DATA_VISUALIZATION",image:yield Z(document.body),topOffset:0};window.parent.postMessage(b,a.origin)})}
window.addEventListener("message",a=>t(function*(){if(za.some(d=>a.origin.includes(d))){var b=a.data;b&&(b.type==="MAKE_SCREENSHOT"&&(yield Ba(a)),b.type==="MAKE_SCREENSHOT_FOR_DATA_VISUALIZATION"&&(yield Ca(a)))}}));
</script><script>(function() {
  // Ensure this script is executed only once
  if (window.firebaseAuthBridgeScriptLoaded) {
    return;
  }
  window.firebaseAuthBridgeScriptLoaded = true;

  let nextTokenPromiseId = 0;

  // Stores { resolve, reject } for ongoing token requests
  const pendingTokenPromises = {};

  // Listen for messages from the Host Application
  window.addEventListener('message', function(event) {

    const messageData = event.data;

  if (messageData && messageData.type === 'RESOLVE_NEW_FIREBASE_TOKEN') {
      const { success, token, error, promiseId } = messageData ?? {};
      if (pendingTokenPromises[promiseId]) {
        if (success) {
          pendingTokenPromises[promiseId].resolve(token);
        } else {
          pendingTokenPromises[promiseId].reject(new Error(error || 'Token refresh failed from host.'));
        }
        delete pendingTokenPromises[promiseId];
      }
    }
  });

  // Expose a function for the Generated App to request a new Firebase token
  window.requestNewFirebaseToken = function() {
    const currentPromiseId = nextTokenPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingTokenPromises[currentPromiseId] = { resolve, reject };
    });
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'REQUEST_NEW_FIREBASE_TOKEN',
        promiseId: currentPromiseId
      }, '*');
    } else {
      pendingTokenPromises[currentPromiseId].reject(new Error('No parent window to request token from.'));
      delete pendingTokenPromises[currentPromiseId];
    }
    return promise;
  };
})();</script><script>
let realOriginalGetUserMedia = null;
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  realOriginalGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
}

(function() {
  if (navigator.mediaDevices && navigator.mediaDevices.__proto__) {
    try {
      Object.defineProperty(navigator.mediaDevices.__proto__, 'getUserMedia', {
        get: function() {
          return undefined; // Or throw an error
        },
        configurable: false
      });
    } catch (error) {
      console.error("Error defining prototype getter:", error);
    }
  }
})();

(function() {
  const pendingMediaResolvers = {};
  let nextMediaPromiseId = 0;

  function requestMediaPermissions(constraints) {
    const mediaPromiseId = nextMediaPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingMediaResolvers[mediaPromiseId] = (granted) => {
        delete pendingMediaResolvers[mediaPromiseId];
        resolve(granted);
      };
    });

    window.parent.postMessage({
      type: 'requestMediaPermission',
      constraints: constraints,
      promiseId: mediaPromiseId,
    }, '*');

    return promise;
  }

  let originalGetUserMedia = realOriginalGetUserMedia;

  function interceptGetUserMedia() {
    if (navigator.mediaDevices) {
      Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
        value: function(constraints) {
          return requestMediaPermissions(constraints).then((granted) => {
            if (granted) {
              if (originalGetUserMedia) {
                return originalGetUserMedia(constraints);
              } else {
                throw new Error("Original getUserMedia not available.");
              }
            } else {
              throw new DOMException('Permission denied', 'NotAllowedError');
            }
          });
        },
        writable: false,
        configurable: false
      });
    }
  }

  interceptGetUserMedia();

  const observer = new MutationObserver(function(mutationsList, observer) {
    for (const mutation of mutationsList) {
      if (mutation.type === 'reconfigured' && mutation.name === 'getUserMedia' && mutation.object === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'attributes' && mutation.attributeName === 'getUserMedia' && mutation.target === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'childList' && mutation.addedNodes) {
        mutation.addedNodes.forEach(node => {
          if (node === navigator.mediaDevices) {
            interceptGetUserMedia();
          }
        });
      }
    }
  });

  function interceptSpeechRecognition() {
    if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
      return;
    }

    const OriginalSpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    const SpeechRecognitionWrapper = function(...args) {
      const recognizer = new OriginalSpeechRecognition(...args);
      const originalStart = recognizer.start.bind(recognizer);

      recognizer.start = function() {
        requestMediaPermissions({ audio: true }).then(granted => {
          if (granted) {
            originalStart();
          } else {
            const errorEvent = new SpeechRecognitionErrorEvent('error');
            errorEvent.error = 'not-allowed'; // This is the standard error for permission denial.
            recognizer.dispatchEvent(errorEvent);
          }
        });
      };

      return recognizer;
    };

    SpeechRecognitionWrapper.prototype = OriginalSpeechRecognition.prototype;
    SpeechRecognitionWrapper.prototype.constructor = SpeechRecognitionWrapper;

    if (window.SpeechRecognition) {
      window.SpeechRecognition = SpeechRecognitionWrapper;
    }
    if (window.webkitSpeechRecognition) {
      window.webkitSpeechRecognition = SpeechRecognitionWrapper;
    }
  }

  interceptSpeechRecognition();

  window.addEventListener('message', function(event) {
    if (event.data) {
      if (event.data.type === 'resolveMediaPermission') {
        const { promiseId, granted } = event.data;
        if (pendingMediaResolvers[promiseId]) {
          pendingMediaResolvers[promiseId](granted);
        }
      }
    }
  });

})();</script><script>((function(modelInformation) {
  const originalFetch = window.fetch;
  // TODO: b/421908508 - Move these out of the script and match all generative AI model calls.
  let googleLlmBaseApiUrls = [
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':streamGenerateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageEditModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageTransformModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.ttsModelName + ':generateContent',
  ];
  modelInformation.deprecatedTextModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':streamGenerateContent',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':generateContent',
    );
  });
  modelInformation.deprecatedImageModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predict',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predictLongRunning',
    );
  });

  const pendingFetchResolvers = {};
  let nextPromiseId = 0;

  function handleStringInput(input, optionsArgument) {
    const actualUrl = input;
    const fetchCallArgs = [actualUrl, optionsArgument];
    const effectiveOptions = optionsArgument || {};
    const bodyForApiKeyCheck = effectiveOptions.body;
    const bodyForPostMessage = effectiveOptions.body;
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  function handleRequestInput(input, optionsArgument) {
    const actualUrl = input.url;
    const fetchCallArgs = [input, optionsArgument];
    const effectiveOptions = { method: input.method, headers: new Headers(input.headers) };
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (optionsArgument) {
      if (optionsArgument.method) effectiveOptions.method = optionsArgument.method;
      if (optionsArgument.headers) effectiveOptions.headers = new Headers(optionsArgument.headers);
      if ('body' in optionsArgument) {
        bodyForApiKeyCheck = optionsArgument.body;
        bodyForPostMessage = optionsArgument.body;
      } else {
        bodyForApiKeyCheck = undefined;
        bodyForPostMessage = input.body;
      }
    } else {
      bodyForApiKeyCheck = undefined;
      bodyForPostMessage = input.body;
    }
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  window.fetch = function(input, optionsArgument) {
    let actualUrl;
    let fetchCallArgs;
    let effectiveOptions = {};
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (typeof input === 'string') {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleStringInput(input, optionsArgument));
    } else if (input instanceof Request) {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleRequestInput(input, optionsArgument));
    } else {
      return originalFetch.apply(window, [input, optionsArgument]);
    }

    effectiveOptions.method = effectiveOptions.method || 'GET';
    if (!effectiveOptions.headers) {
      effectiveOptions.headers = new Headers();
    }


    if (typeof actualUrl === 'string' && googleLlmBaseApiUrls.some((url) => actualUrl.startsWith(url))) {
      let apiKeyIsNull = true;

      const regex = new RegExp("models/([^:]+)");
      const modelNameMatch = actualUrl.match(regex);
      const modelName = modelNameMatch ? modelNameMatch[1] : 'unspecified';


      try {
        const urlObject = new URL(actualUrl);  // Use URL object for robust parsing
        const apiKeyParam = urlObject.searchParams.get('key');
        if (apiKeyParam) {
          apiKeyIsNull = false;
        }
      } catch (e) {
        // Continue checks even if URL parsing fails
      }

      if (apiKeyIsNull && effectiveOptions.headers) {
        const h = new Headers(effectiveOptions.headers);
        const apiKeyHeaderValue = h.get('X-API-Key') || h.get('x-api-key');
        if (apiKeyHeaderValue) {
          apiKeyIsNull = false;
          return originalFetch.apply(window, fetchCallArgs);
        }
      }

      if (apiKeyIsNull && effectiveOptions.method && ['POST', 'PUT', 'PATCH'].includes(effectiveOptions.method.toUpperCase()) && typeof bodyForApiKeyCheck === 'string') {
        try {
          const bodyData = JSON.parse(bodyForApiKeyCheck);
          if (bodyData && bodyData.apiKey) {
            apiKeyIsNull = false;
            return originalFetch.apply(window, fetchCallArgs);
          }
        } catch (e) {
          // Ignore JSON parsing errors
        }
      }

      if(apiKeyIsNull) {
        const promiseId = nextPromiseId++;
        const promise = new Promise((resolve) => {
          pendingFetchResolvers[promiseId] = (resolvedResponse) => {
            delete pendingFetchResolvers[promiseId];
            resolve(resolvedResponse);
          };
        });

        let serializedBodyForPostMessage;
        if (typeof bodyForPostMessage === 'string' || bodyForPostMessage == null) {
            serializedBodyForPostMessage = bodyForPostMessage;
        } else if (bodyForPostMessage instanceof ReadableStream) {
            serializedBodyForPostMessage = null;
        } else {
            try {
                serializedBodyForPostMessage = JSON.stringify(bodyForPostMessage);
            } catch (e) {
                serializedBodyForPostMessage = null;
            }
        }

        const messageOptions = {
            method: effectiveOptions.method,
            headers: Object.fromEntries(new Headers(effectiveOptions.headers).entries()),
            body: serializedBodyForPostMessage
        };

        window.parent.postMessage({
          type: 'requestFetch',
          url: actualUrl,
          modelName: modelName,
          options: messageOptions,
          promiseId: promiseId,
        }, '*');

        return promise;
      }
      return originalFetch.apply(window, fetchCallArgs);
    }
    return originalFetch.apply(window, fetchCallArgs);
  };

  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'resolveFetch') {
      const { promiseId, response } = event.data;
      if (pendingFetchResolvers[promiseId]) {
        try {
          const reconstructedResponse = new Response(response.body, {
            status: response.status,
            statusText: response.statusText,
            headers: new Headers(response.headers),
          });
          pendingFetchResolvers[promiseId](reconstructedResponse);
        } catch (error) {
          pendingFetchResolvers[promiseId](new Response(null, { status: 500, statusText: "Interceptor Response Reconstruction Error" }));
        }
      }
    }
  });

}))({"textModelName":"gemini-2.5-flash-preview-09-2025","imageModelName":"imagen-4.0-generate-001","imageEditModelName":"gemini-2.5-flash-image-preview","imageTransformModelName":"gemini-3-pro-image-preview-11-2025","videoModelName":"veo-2.0-generate-001","ttsModelName":"gemini-2.5-flash-preview-tts","deprecatedTextModelNames":["gemini-2.0-flash","gemini-2.5-flash-preview-04-17","gemini-2.5-flash-preview-05-20"],"deprecatedImageModelNames":["imagen-3.0-generate-001","imagen-3.0-generate-002"]})</script><script>(function() {
  const originalConsoleLog = console.log;
  const originalConsoleError = console.error;

    /**
   * Normalizes an error event or a promise rejection reason into a structured error object.
   * @param {*} errorEventOrReason The error object or reason.
   * @return {object} Structured error data { message, name, stack }.
   */
  function getErrorObject(errorEventOrReason) {
    if (errorEventOrReason instanceof Error) {
      return {
        message: errorEventOrReason.message,
        name: errorEventOrReason.name,
        stack: errorEventOrReason.stack,
      };
    }
    // Fallback for non-Error objects.
    try {
      return {
        message: JSON.stringify(errorEventOrReason),
        name: 'UnknownErrorType',
        stack: null,
      };
    } catch (e) {
      return {
        message: String(errorEventOrReason),
        name: 'UnknownErrorTypeNonStringifiable',
        stack: null,
      };
    }
  }

  /**
   * Converts an array of arguments (from log/error) into a single string.
   * Handles Error objects specially to include their message and stack.
   * @param {Array<*>} args - Arguments passed to console methods.
   * @return {string} A string representation of the arguments.
   */
  function stringifyArgs(args) {
    return args
      .map((arg) => {
        if (arg instanceof Error) {
          const {message, stack} = arg;
          return `Error: ${message}${stack ? ('\nStack: ' + stack) : ''}`;
        }
        if (typeof arg === 'object' && arg !== null) {
          try {
            return JSON.stringify(arg);
          } catch (error) {
            return '[Circular Object]';
          }
        } else {
          return String(arg);
        }
      })
      .join(' ');
  }

  console.log = function(...args) {
    const logString = stringifyArgs(args);
    window.parent.postMessage({ type: 'log', message: logString }, '*');
    originalConsoleLog.apply(console, args);
  };

  console.error = function(...args) {
    let errorData;
    if (args.length > 0 && args[0] instanceof Error) {
      const err = args[0];
      // If the first arg is an Error, capture its details.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        ...getErrorObject(err),
        rawArgsString: stringifyArgs(args.slice(1)),
        timestamp: new Date().toISOString(),
      };
    } else {
      // If not an Error object, treat all args as a general error message.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        message: stringifyArgs(args),
        name: 'ConsoleLoggedError',
        stack: null,
        timestamp: new Date().toISOString(),
      };
    }
    window.parent.postMessage(errorData, '*');
    originalConsoleError.apply(console, args);
  };

  // Listen for global unhandled synchronous errors.
  window.addEventListener('error', function(event) {
    const errorDetails = event.error ? getErrorObject(event.error) : {
      message: event.message,
      name: 'GlobalError',
      stack: null,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
    };

    window.parent.postMessage({
      type: 'error',
      source: 'global',
      ...errorDetails,
      message: errorDetails.message || event.message,
      timestamp: new Date().toISOString(),
    }, '*');
  });

  // Listen for unhandled promise rejections (asynchronous errors).
  window.addEventListener('unhandledrejection', function(event) {
    const errorDetails = getErrorObject(event.reason);

    window.parent.postMessage({
      type: 'error',
      source: 'unhandledrejection',
      ...errorDetails,
      message: errorDetails.message || 'Unhandled Promise Rejection',
      timestamp: new Date().toISOString(),
    }, '*');
  });

})();</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Truy Tìm Kho Báu - Vectơ Lớp 10</title>
    
    <!-- Thư viện giao diện và tiện ích -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" crossorigin="anonymous"></script>

    <!-- Google Fonts cho style Game -->
    <style type="text/css">:host,:root{--fa-font-solid:normal 900 1em/1 "Font Awesome 6 Solid";--fa-font-regular:normal 400 1em/1 "Font Awesome 6 Regular";--fa-font-light:normal 300 1em/1 "Font Awesome 6 Light";--fa-font-thin:normal 100 1em/1 "Font Awesome 6 Thin";--fa-font-duotone:normal 900 1em/1 "Font Awesome 6 Duotone";--fa-font-sharp-solid:normal 900 1em/1 "Font Awesome 6 Sharp";--fa-font-sharp-regular:normal 400 1em/1 "Font Awesome 6 Sharp";--fa-font-sharp-light:normal 300 1em/1 "Font Awesome 6 Sharp";--fa-font-brands:normal 400 1em/1 "Font Awesome 6 Brands"}svg:not(:host).svg-inline--fa,svg:not(:root).svg-inline--fa{overflow:visible;box-sizing:content-box}.svg-inline--fa{display:var(--fa-display,inline-block);height:1em;overflow:visible;vertical-align:-.125em}.svg-inline--fa.fa-2xs{vertical-align:.1em}.svg-inline--fa.fa-xs{vertical-align:0}.svg-inline--fa.fa-sm{vertical-align:-.0714285705em}.svg-inline--fa.fa-lg{vertical-align:-.2em}.svg-inline--fa.fa-xl{vertical-align:-.25em}.svg-inline--fa.fa-2xl{vertical-align:-.3125em}.svg-inline--fa.fa-pull-left{margin-right:var(--fa-pull-margin,.3em);width:auto}.svg-inline--fa.fa-pull-right{margin-left:var(--fa-pull-margin,.3em);width:auto}.svg-inline--fa.fa-li{width:var(--fa-li-width,2em);top:.25em}.svg-inline--fa.fa-fw{width:var(--fa-fw-width,1.25em)}.fa-layers svg.svg-inline--fa{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.fa-layers-counter,.fa-layers-text{display:inline-block;position:absolute;text-align:center}.fa-layers{display:inline-block;height:1em;position:relative;text-align:center;vertical-align:-.125em;width:1em}.fa-layers svg.svg-inline--fa{-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-text{left:50%;top:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter{background-color:var(--fa-counter-background-color,#ff253a);border-radius:var(--fa-counter-border-radius,1em);box-sizing:border-box;color:var(--fa-inverse,#fff);line-height:var(--fa-counter-line-height,1);max-width:var(--fa-counter-max-width,5em);min-width:var(--fa-counter-min-width,1.5em);overflow:hidden;padding:var(--fa-counter-padding,.25em .5em);right:var(--fa-right,0);text-overflow:ellipsis;top:var(--fa-top,0);-webkit-transform:scale(var(--fa-counter-scale,.25));transform:scale(var(--fa-counter-scale,.25));-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-bottom-right{bottom:var(--fa-bottom,0);right:var(--fa-right,0);top:auto;-webkit-transform:scale(var(--fa-layers-scale,.25));transform:scale(var(--fa-layers-scale,.25));-webkit-transform-origin:bottom right;transform-origin:bottom right}.fa-layers-bottom-left{bottom:var(--fa-bottom,0);left:var(--fa-left,0);right:auto;top:auto;-webkit-transform:scale(var(--fa-layers-scale,.25));transform:scale(var(--fa-layers-scale,.25));-webkit-transform-origin:bottom left;transform-origin:bottom left}.fa-layers-top-right{top:var(--fa-top,0);right:var(--fa-right,0);-webkit-transform:scale(var(--fa-layers-scale,.25));transform:scale(var(--fa-layers-scale,.25));-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-top-left{left:var(--fa-left,0);right:auto;top:var(--fa-top,0);-webkit-transform:scale(var(--fa-layers-scale,.25));transform:scale(var(--fa-layers-scale,.25));-webkit-transform-origin:top left;transform-origin:top left}.fa-1x{font-size:1em}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-6x{font-size:6em}.fa-7x{font-size:7em}.fa-8x{font-size:8em}.fa-9x{font-size:9em}.fa-10x{font-size:10em}.fa-2xs{font-size:.625em;line-height:.1em;vertical-align:.225em}.fa-xs{font-size:.75em;line-height:.0833333337em;vertical-align:.125em}.fa-sm{font-size:.875em;line-height:.0714285718em;vertical-align:.0535714295em}.fa-lg{font-size:1.25em;line-height:.05em;vertical-align:-.075em}.fa-xl{font-size:1.5em;line-height:.0416666682em;vertical-align:-.125em}.fa-2xl{font-size:2em;line-height:.03125em;vertical-align:-.1875em}.fa-fw{text-align:center;width:1.25em}.fa-ul{list-style-type:none;margin-left:var(--fa-li-margin,2.5em);padding-left:0}.fa-ul>li{position:relative}.fa-li{left:calc(var(--fa-li-width,2em) * -1);position:absolute;text-align:center;width:var(--fa-li-width,2em);line-height:inherit}.fa-border{border-color:var(--fa-border-color,#eee);border-radius:var(--fa-border-radius,.1em);border-style:var(--fa-border-style,solid);border-width:var(--fa-border-width,.08em);padding:var(--fa-border-padding,.2em .25em .15em)}.fa-pull-left{float:left;margin-right:var(--fa-pull-margin,.3em)}.fa-pull-right{float:right;margin-left:var(--fa-pull-margin,.3em)}.fa-beat{-webkit-animation-name:fa-beat;animation-name:fa-beat;-webkit-animation-delay:var(--fa-animation-delay,0s);animation-delay:var(--fa-animation-delay,0s);-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:var(--fa-animation-direction,normal);-webkit-animation-duration:var(--fa-animation-duration,1s);animation-duration:var(--fa-animation-duration,1s);-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-timing-function:var(--fa-animation-timing,ease-in-out);animation-timing-function:var(--fa-animation-timing,ease-in-out)}.fa-bounce{-webkit-animation-name:fa-bounce;animation-name:fa-bounce;-webkit-animation-delay:var(--fa-animation-delay,0s);animation-delay:var(--fa-animation-delay,0s);-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:var(--fa-animation-direction,normal);-webkit-animation-duration:var(--fa-animation-duration,1s);animation-duration:var(--fa-animation-duration,1s);-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-timing-function:var(--fa-animation-timing,cubic-bezier(.28,.84,.42,1));animation-timing-function:var(--fa-animation-timing,cubic-bezier(.28,.84,.42,1))}.fa-fade{-webkit-animation-name:fa-fade;animation-name:fa-fade;-webkit-animation-delay:var(--fa-animation-delay,0s);animation-delay:var(--fa-animation-delay,0s);-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:var(--fa-animation-direction,normal);-webkit-animation-duration:var(--fa-animation-duration,1s);animation-duration:var(--fa-animation-duration,1s);-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-timing-function:var(--fa-animation-timing,cubic-bezier(.4,0,.6,1));animation-timing-function:var(--fa-animation-timing,cubic-bezier(.4,0,.6,1))}.fa-beat-fade{-webkit-animation-name:fa-beat-fade;animation-name:fa-beat-fade;-webkit-animation-delay:var(--fa-animation-delay,0s);animation-delay:var(--fa-animation-delay,0s);-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:var(--fa-animation-direction,normal);-webkit-animation-duration:var(--fa-animation-duration,1s);animation-duration:var(--fa-animation-duration,1s);-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-timing-function:var(--fa-animation-timing,cubic-bezier(.4,0,.6,1));animation-timing-function:var(--fa-animation-timing,cubic-bezier(.4,0,.6,1))}.fa-flip{-webkit-animation-name:fa-flip;animation-name:fa-flip;-webkit-animation-delay:var(--fa-animation-delay,0s);animation-delay:var(--fa-animation-delay,0s);-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:var(--fa-animation-direction,normal);-webkit-animation-duration:var(--fa-animation-duration,1s);animation-duration:var(--fa-animation-duration,1s);-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-timing-function:var(--fa-animation-timing,ease-in-out);animation-timing-function:var(--fa-animation-timing,ease-in-out)}.fa-shake{-webkit-animation-name:fa-shake;animation-name:fa-shake;-webkit-animation-delay:var(--fa-animation-delay,0s);animation-delay:var(--fa-animation-delay,0s);-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:var(--fa-animation-direction,normal);-webkit-animation-duration:var(--fa-animation-duration,1s);animation-duration:var(--fa-animation-duration,1s);-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-timing-function:var(--fa-animation-timing,linear);animation-timing-function:var(--fa-animation-timing,linear)}.fa-spin{-webkit-animation-name:fa-spin;animation-name:fa-spin;-webkit-animation-delay:var(--fa-animation-delay,0s);animation-delay:var(--fa-animation-delay,0s);-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:var(--fa-animation-direction,normal);-webkit-animation-duration:var(--fa-animation-duration,2s);animation-duration:var(--fa-animation-duration,2s);-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-timing-function:var(--fa-animation-timing,linear);animation-timing-function:var(--fa-animation-timing,linear)}.fa-spin-reverse{--fa-animation-direction:reverse}.fa-pulse,.fa-spin-pulse{-webkit-animation-name:fa-spin;animation-name:fa-spin;-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:var(--fa-animation-direction,normal);-webkit-animation-duration:var(--fa-animation-duration,1s);animation-duration:var(--fa-animation-duration,1s);-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-timing-function:var(--fa-animation-timing,steps(8));animation-timing-function:var(--fa-animation-timing,steps(8))}@media (prefers-reduced-motion:reduce){.fa-beat,.fa-beat-fade,.fa-bounce,.fa-fade,.fa-flip,.fa-pulse,.fa-shake,.fa-spin,.fa-spin-pulse{-webkit-animation-delay:-1ms;animation-delay:-1ms;-webkit-animation-duration:1ms;animation-duration:1ms;-webkit-animation-iteration-count:1;animation-iteration-count:1;-webkit-transition-delay:0s;transition-delay:0s;-webkit-transition-duration:0s;transition-duration:0s}}@-webkit-keyframes fa-beat{0%,90%{-webkit-transform:scale(1);transform:scale(1)}45%{-webkit-transform:scale(var(--fa-beat-scale,1.25));transform:scale(var(--fa-beat-scale,1.25))}}@keyframes fa-beat{0%,90%{-webkit-transform:scale(1);transform:scale(1)}45%{-webkit-transform:scale(var(--fa-beat-scale,1.25));transform:scale(var(--fa-beat-scale,1.25))}}@-webkit-keyframes fa-bounce{0%{-webkit-transform:scale(1,1) translateY(0);transform:scale(1,1) translateY(0)}10%{-webkit-transform:scale(var(--fa-bounce-start-scale-x,1.1),var(--fa-bounce-start-scale-y,.9)) translateY(0);transform:scale(var(--fa-bounce-start-scale-x,1.1),var(--fa-bounce-start-scale-y,.9)) translateY(0)}30%{-webkit-transform:scale(var(--fa-bounce-jump-scale-x,.9),var(--fa-bounce-jump-scale-y,1.1)) translateY(var(--fa-bounce-height,-.5em));transform:scale(var(--fa-bounce-jump-scale-x,.9),var(--fa-bounce-jump-scale-y,1.1)) translateY(var(--fa-bounce-height,-.5em))}50%{-webkit-transform:scale(var(--fa-bounce-land-scale-x,1.05),var(--fa-bounce-land-scale-y,.95)) translateY(0);transform:scale(var(--fa-bounce-land-scale-x,1.05),var(--fa-bounce-land-scale-y,.95)) translateY(0)}57%{-webkit-transform:scale(1,1) translateY(var(--fa-bounce-rebound,-.125em));transform:scale(1,1) translateY(var(--fa-bounce-rebound,-.125em))}64%{-webkit-transform:scale(1,1) translateY(0);transform:scale(1,1) translateY(0)}100%{-webkit-transform:scale(1,1) translateY(0);transform:scale(1,1) translateY(0)}}@keyframes fa-bounce{0%{-webkit-transform:scale(1,1) translateY(0);transform:scale(1,1) translateY(0)}10%{-webkit-transform:scale(var(--fa-bounce-start-scale-x,1.1),var(--fa-bounce-start-scale-y,.9)) translateY(0);transform:scale(var(--fa-bounce-start-scale-x,1.1),var(--fa-bounce-start-scale-y,.9)) translateY(0)}30%{-webkit-transform:scale(var(--fa-bounce-jump-scale-x,.9),var(--fa-bounce-jump-scale-y,1.1)) translateY(var(--fa-bounce-height,-.5em));transform:scale(var(--fa-bounce-jump-scale-x,.9),var(--fa-bounce-jump-scale-y,1.1)) translateY(var(--fa-bounce-height,-.5em))}50%{-webkit-transform:scale(var(--fa-bounce-land-scale-x,1.05),var(--fa-bounce-land-scale-y,.95)) translateY(0);transform:scale(var(--fa-bounce-land-scale-x,1.05),var(--fa-bounce-land-scale-y,.95)) translateY(0)}57%{-webkit-transform:scale(1,1) translateY(var(--fa-bounce-rebound,-.125em));transform:scale(1,1) translateY(var(--fa-bounce-rebound,-.125em))}64%{-webkit-transform:scale(1,1) translateY(0);transform:scale(1,1) translateY(0)}100%{-webkit-transform:scale(1,1) translateY(0);transform:scale(1,1) translateY(0)}}@-webkit-keyframes fa-fade{50%{opacity:var(--fa-fade-opacity,.4)}}@keyframes fa-fade{50%{opacity:var(--fa-fade-opacity,.4)}}@-webkit-keyframes fa-beat-fade{0%,100%{opacity:var(--fa-beat-fade-opacity,.4);-webkit-transform:scale(1);transform:scale(1)}50%{opacity:1;-webkit-transform:scale(var(--fa-beat-fade-scale,1.125));transform:scale(var(--fa-beat-fade-scale,1.125))}}@keyframes fa-beat-fade{0%,100%{opacity:var(--fa-beat-fade-opacity,.4);-webkit-transform:scale(1);transform:scale(1)}50%{opacity:1;-webkit-transform:scale(var(--fa-beat-fade-scale,1.125));transform:scale(var(--fa-beat-fade-scale,1.125))}}@-webkit-keyframes fa-flip{50%{-webkit-transform:rotate3d(var(--fa-flip-x,0),var(--fa-flip-y,1),var(--fa-flip-z,0),var(--fa-flip-angle,-180deg));transform:rotate3d(var(--fa-flip-x,0),var(--fa-flip-y,1),var(--fa-flip-z,0),var(--fa-flip-angle,-180deg))}}@keyframes fa-flip{50%{-webkit-transform:rotate3d(var(--fa-flip-x,0),var(--fa-flip-y,1),var(--fa-flip-z,0),var(--fa-flip-angle,-180deg));transform:rotate3d(var(--fa-flip-x,0),var(--fa-flip-y,1),var(--fa-flip-z,0),var(--fa-flip-angle,-180deg))}}@-webkit-keyframes fa-shake{0%{-webkit-transform:rotate(-15deg);transform:rotate(-15deg)}4%{-webkit-transform:rotate(15deg);transform:rotate(15deg)}24%,8%{-webkit-transform:rotate(-18deg);transform:rotate(-18deg)}12%,28%{-webkit-transform:rotate(18deg);transform:rotate(18deg)}16%{-webkit-transform:rotate(-22deg);transform:rotate(-22deg)}20%{-webkit-transform:rotate(22deg);transform:rotate(22deg)}32%{-webkit-transform:rotate(-12deg);transform:rotate(-12deg)}36%{-webkit-transform:rotate(12deg);transform:rotate(12deg)}100%,40%{-webkit-transform:rotate(0);transform:rotate(0)}}@keyframes fa-shake{0%{-webkit-transform:rotate(-15deg);transform:rotate(-15deg)}4%{-webkit-transform:rotate(15deg);transform:rotate(15deg)}24%,8%{-webkit-transform:rotate(-18deg);transform:rotate(-18deg)}12%,28%{-webkit-transform:rotate(18deg);transform:rotate(18deg)}16%{-webkit-transform:rotate(-22deg);transform:rotate(-22deg)}20%{-webkit-transform:rotate(22deg);transform:rotate(22deg)}32%{-webkit-transform:rotate(-12deg);transform:rotate(-12deg)}36%{-webkit-transform:rotate(12deg);transform:rotate(12deg)}100%,40%{-webkit-transform:rotate(0);transform:rotate(0)}}@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes fa-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.fa-rotate-90{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.fa-rotate-180{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.fa-rotate-270{-webkit-transform:rotate(270deg);transform:rotate(270deg)}.fa-flip-horizontal{-webkit-transform:scale(-1,1);transform:scale(-1,1)}.fa-flip-vertical{-webkit-transform:scale(1,-1);transform:scale(1,-1)}.fa-flip-both,.fa-flip-horizontal.fa-flip-vertical{-webkit-transform:scale(-1,-1);transform:scale(-1,-1)}.fa-rotate-by{-webkit-transform:rotate(var(--fa-rotate-angle,none));transform:rotate(var(--fa-rotate-angle,none))}.fa-stack{display:inline-block;vertical-align:middle;height:2em;position:relative;width:2.5em}.fa-stack-1x,.fa-stack-2x{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;z-index:var(--fa-stack-z-index,auto)}.svg-inline--fa.fa-stack-1x{height:1em;width:1.25em}.svg-inline--fa.fa-stack-2x{height:2em;width:2.5em}.fa-inverse{color:var(--fa-inverse,#fff)}.fa-sr-only,.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.fa-sr-only-focusable:not(:focus),.sr-only-focusable:not(:focus){position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.svg-inline--fa .fa-primary{fill:var(--fa-primary-color,currentColor);opacity:var(--fa-primary-opacity,1)}.svg-inline--fa .fa-secondary{fill:var(--fa-secondary-color,currentColor);opacity:var(--fa-secondary-opacity,.4)}.svg-inline--fa.fa-swap-opacity .fa-primary{opacity:var(--fa-secondary-opacity,.4)}.svg-inline--fa.fa-swap-opacity .fa-secondary{opacity:var(--fa-primary-opacity,1)}.svg-inline--fa mask .fa-primary,.svg-inline--fa mask .fa-secondary{fill:#000}.fa-duotone.fa-inverse,.fad.fa-inverse{color:var(--fa-inverse,#fff)}</style><style>
        @import url('https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Roboto:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Lobster&display=swap');
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #1a202c;
            overflow-x: hidden;
            touch-action: manipulation;
            height: 100vh;
        }
        
        .font-hand { font-family: 'Patrick Hand', cursive; }
        .font-pirate { font-family: 'Lobster', cursive; }

        .map-bg {
            background-image: url('https://yt3.ggpht.com/ztjCXcKsJQVk4iNc4zkbloptN1S7xJH0N6anxS-ALTa1g1jf5FmxyX3U6mdwFKs7547f9G5ZmEuYJA=s342-c-fcrop64=1,1fca0000e035ffff-rw-nd-v1');
            background-size: 100% 100%;
            background-repeat: no-repeat;
            background-position: center;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.5);
        }

        .stage-node {
            transition: all 0.3s ease;
            cursor: pointer;
            z-index: 40; 
            -webkit-tap-highlight-color: transparent;
        }
        .stage-node:active { transform: scale(0.95); }
        .stage-node:hover { transform: scale(1.1); filter: brightness(1.2); }
        
        .stage-completed { filter: grayscale(100%); opacity: 0.8; pointer-events: none; }

        @keyframes popSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); filter: brightness(1.2); box-shadow: 0 0 15px rgba(72, 187, 120, 0.5); }
            100% { transform: scale(1); }
        }
        .animate-pop { animation: popSuccess 0.4s ease-out; }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .floating { animation: float 3s ease-in-out infinite; }

        #player-character {
            transition: top 1.5s ease-in-out, left 1.5s ease-in-out;
            pointer-events: none;
        }

        @keyframes zoomIn {
            0% { transform: scale(0.1); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-zoom-in { animation: zoomIn 0.8s ease-out forwards; }

        .parchment-modal {
            background-color: #fdf6e3;
            background-image: url("https://www.transparenttextures.com/patterns/aged-paper.png");
            border: 4px solid #8d6e63;
            box-shadow: 0 10px 25px rgba(0,0,0,0.7);
            border-radius: 12px;
            max-height: 90vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .option-btn {
            background-color: #fff;
            border: 2px solid #d4a373;
            color: #5d4037;
            font-weight: 600;
            transition: all 0.2s;
            font-size: 1.1rem;
            font-family: 'Times New Roman', serif !important;
            touch-action: manipulation;
        }
        .option-btn:hover:not(:disabled) {
            background-color: #faedcd;
            transform: translateX(5px);
            border-color: #a98467;
        }

        .correct-answer {
            background-color: #48bb78 !important; 
            color: white !important;
            border-color: #2f855a !important;
            box-shadow: 0 0 10px #48bb78;
        }
        .wrong-answer {
            background-color: #f56565 !important; 
            color: white !important;
            opacity: 0.8;
            border-color: #c53030 !important;
        }
        
        .vect {
            position: relative;
            display: inline-block;
            font-weight: bold;
            font-family: 'Times New Roman', serif;
            font-style: italic;
        }
        .vect::before {
            content: "→";
            position: absolute;
            top: -0.7em;
            left: 50%;
            transform: translateX(-50%) scale(0.8);
            font-size: 1.1em;
            font-style: normal;
            font-family: sans-serif;
        }

        .math-type {
            font-family: 'Times New Roman', serif;
            font-size: 1.1em;
        }

        .q-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background: white;
            border: 2px solid #5d4037;
        }
        .q-table th, .q-table td {
            border: 1px solid #8d6e63;
            padding: 12px;
            text-align: left;
            font-family: 'Times New Roman', serif;
            font-size: 1.2rem;
        }
        .q-table th {
            text-align: center;
            background-color: #fff3e0;
            color: #c0392b; 
            font-weight: bold;
        }
        .q-table td.text-center { text-align: center; }
        .radio-custom {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: #d35400;
        }
        
        /* CẬP NHẬT CSS: Đảm bảo tô màu cả hàng (kể cả các ô td con) */
        .row-correct, .row-correct td { 
            background-color: #d1fae5 !important; 
        }
        .row-wrong, .row-wrong td { 
            background-color: #ffb6c1 !important; /* Màu hồng rõ (LightPink) */
        }

        #q-content {
            font-family: 'Times New Roman', serif !important;
            color: #1e3a8a !important; 
            font-weight: bold;
        }

        /* Thêm style cho màn hình Nhiệm Vụ */
        .mission-text-shadow {
            text-shadow: 1px 1px 0px rgba(255, 255, 255, 0.5);
        }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.pointer-events-none{pointer-events:none}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.inset-0{inset:0px}.-bottom-4{bottom:-1rem}.-bottom-8{bottom:-2rem}.-left-2{left:-0.5rem}.-right-1{right:-0.25rem}.-right-10{right:-2.5rem}.-right-2{right:-0.5rem}.-top-1{top:-0.25rem}.-top-10{top:-2.5rem}.-top-4{top:-1rem}.bottom-0{bottom:0px}.bottom-10{bottom:2.5rem}.bottom-16{bottom:4rem}.left-1\/2{left:50%}.left-4{left:1rem}.right-0{right:0px}.right-4{right:1rem}.top-0{top:0px}.top-4{top:1rem}.z-30{z-index:30}.z-40{z-index:40}.z-50{z-index:50}.z-\[100\]{z-index:100}.z-\[101\]{z-index:101}.z-\[102\]{z-index:102}.z-\[60\]{z-index:60}.z-\[90\]{z-index:90}.m-4{margin:1rem}.mx-0{margin-left:0px;margin-right:0px}.mx-1{margin-left:0.25rem;margin-right:0.25rem}.mx-4{margin-left:1rem;margin-right:1rem}.my-4{margin-top:1rem;margin-bottom:1rem}.my-8{margin-top:2rem;margin-bottom:2rem}.mb-2{margin-bottom:0.5rem}.mb-3{margin-bottom:0.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.ml-2{margin-left:0.5rem}.mt-1{margin-top:0.25rem}.mt-2{margin-top:0.5rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.mt-8{margin-top:2rem}.inline-block{display:inline-block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-10{height:2.5rem}.h-14{height:3.5rem}.h-20{height:5rem}.h-24{height:6rem}.h-3{height:0.75rem}.h-40{height:10rem}.h-80{height:20rem}.h-full{height:100%}.max-h-\[90vh\]{max-height:90vh}.max-h-screen{max-height:100vh}.w-10{width:2.5rem}.w-11\/12{width:91.666667%}.w-14{width:3.5rem}.w-20{width:5rem}.w-24{width:6rem}.w-3{width:0.75rem}.w-40{width:10rem}.w-8{width:2rem}.w-fit{width:-moz-fit-content;width:fit-content}.w-full{width:100%}.max-w-2xl{max-width:42rem}.max-w-3xl{max-width:48rem}.max-w-md{max-width:28rem}.flex-shrink-0{flex-shrink:0}.shrink-0{flex-shrink:0}.flex-grow{flex-grow:1}.-translate-x-1\/2{--tw-translate-x:-50%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-full{--tw-translate-x:100%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-rotate-12{--tw-rotate:-12deg;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-rotate-2{--tw-rotate:-2deg;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-rotate-3{--tw-rotate:-3deg;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.rotate-1{--tw-rotate:1deg;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.rotate-12{--tw-rotate:12deg;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.rotate-3{--tw-rotate:3deg;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes bounce{0%, 100%{transform:translateY(-25%);animation-timing-function:cubic-bezier(0.8,0,1,1)}50%{transform:none;animation-timing-function:cubic-bezier(0,0,0.2,1)}}.animate-bounce{animation:bounce 1s infinite}@keyframes ping{75%, 100%{transform:scale(2);opacity:0}}.animate-ping{animation:ping 1s cubic-bezier(0, 0, 0.2, 1) infinite}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite}.cursor-default{cursor:default}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-end{align-items:flex-end}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-1{gap:0.25rem}.gap-2{gap:0.5rem}.gap-4{gap:1rem}.space-y-4 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.overflow-hidden{overflow:hidden}.overflow-visible{overflow:visible}.overflow-y-auto{overflow-y:auto}.whitespace-nowrap{white-space:nowrap}.rounded{border-radius:0.25rem}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-xl{border-radius:0.75rem}.border{border-width:1px}.border-2{border-width:2px}.border-4{border-width:4px}.border-y-4{border-top-width:4px;border-bottom-width:4px}.border-b{border-bottom-width:1px}.border-b-2{border-bottom-width:2px}.border-l-4{border-left-width:4px}.border-t{border-top-width:1px}.border-dashed{border-style:dashed}.border-double{border-style:double}.border-blue-100{--tw-border-opacity:1;border-color:rgb(219 234 254 / var(--tw-border-opacity, 1))}.border-blue-300{--tw-border-opacity:1;border-color:rgb(147 197 253 / var(--tw-border-opacity, 1))}.border-blue-400{--tw-border-opacity:1;border-color:rgb(96 165 250 / var(--tw-border-opacity, 1))}.border-blue-600{--tw-border-opacity:1;border-color:rgb(37 99 235 / var(--tw-border-opacity, 1))}.border-blue-800{--tw-border-opacity:1;border-color:rgb(30 64 175 / var(--tw-border-opacity, 1))}.border-gray-400{--tw-border-opacity:1;border-color:rgb(156 163 175 / var(--tw-border-opacity, 1))}.border-gray-600{--tw-border-opacity:1;border-color:rgb(75 85 99 / var(--tw-border-opacity, 1))}.border-green-500{--tw-border-opacity:1;border-color:rgb(34 197 94 / var(--tw-border-opacity, 1))}.border-purple-400{--tw-border-opacity:1;border-color:rgb(192 132 252 / var(--tw-border-opacity, 1))}.border-red-400{--tw-border-opacity:1;border-color:rgb(248 113 113 / var(--tw-border-opacity, 1))}.border-red-800{--tw-border-opacity:1;border-color:rgb(153 27 27 / var(--tw-border-opacity, 1))}.border-white{--tw-border-opacity:1;border-color:rgb(255 255 255 / var(--tw-border-opacity, 1))}.border-yellow-500{--tw-border-opacity:1;border-color:rgb(234 179 8 / var(--tw-border-opacity, 1))}.border-yellow-600{--tw-border-opacity:1;border-color:rgb(202 138 4 / var(--tw-border-opacity, 1))}.border-yellow-800{--tw-border-opacity:1;border-color:rgb(133 77 14 / var(--tw-border-opacity, 1))}.border-yellow-800\/30{border-color:rgb(133 77 14 / 0.3)}.bg-black{--tw-bg-opacity:1;background-color:rgb(0 0 0 / var(--tw-bg-opacity, 1))}.bg-black\/50{background-color:rgb(0 0 0 / 0.5)}.bg-black\/70{background-color:rgb(0 0 0 / 0.7)}.bg-black\/80{background-color:rgb(0 0 0 / 0.8)}.bg-black\/85{background-color:rgb(0 0 0 / 0.85)}.bg-blue-100{--tw-bg-opacity:1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.bg-blue-700{--tw-bg-opacity:1;background-color:rgb(29 78 216 / var(--tw-bg-opacity, 1))}.bg-gray-200{--tw-bg-opacity:1;background-color:rgb(229 231 235 / var(--tw-bg-opacity, 1))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.bg-gray-700{--tw-bg-opacity:1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}.bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}.bg-gray-900{--tw-bg-opacity:1;background-color:rgb(17 24 39 / var(--tw-bg-opacity, 1))}.bg-gray-900\/95{background-color:rgb(17 24 39 / 0.95)}.bg-green-600{--tw-bg-opacity:1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.bg-purple-600{--tw-bg-opacity:1;background-color:rgb(147 51 234 / var(--tw-bg-opacity, 1))}.bg-red-500{--tw-bg-opacity:1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1))}.bg-red-600{--tw-bg-opacity:1;background-color:rgb(220 38 38 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-white\/20{background-color:rgb(255 255 255 / 0.2)}.bg-white\/50{background-color:rgb(255 255 255 / 0.5)}.bg-white\/60{background-color:rgb(255 255 255 / 0.6)}.bg-white\/90{background-color:rgb(255 255 255 / 0.9)}.bg-yellow-100\/95{background-color:rgb(254 249 195 / 0.95)}.bg-yellow-200\/50{background-color:rgb(254 240 138 / 0.5)}.bg-yellow-600{--tw-bg-opacity:1;background-color:rgb(202 138 4 / var(--tw-bg-opacity, 1))}.bg-yellow-700{--tw-bg-opacity:1;background-color:rgb(161 98 7 / var(--tw-bg-opacity, 1))}.bg-yellow-900\/60{background-color:rgb(113 63 18 / 0.6)}.bg-yellow-50{--tw-bg-opacity:1;background-color:rgb(254 252 232 / var(--tw-bg-opacity, 1))}.bg-gradient-to-br{background-image:linear-gradient(to bottom right, var(--tw-gradient-stops))}.from-yellow-300{--tw-gradient-from:#fde047 var(--tw-gradient-from-position);--tw-gradient-to:rgb(253 224 71 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.to-yellow-600{--tw-gradient-to:#ca8a04 var(--tw-gradient-to-position)}.object-contain{object-fit:contain}.object-cover{object-fit:cover}.p-1{padding:0.25rem}.p-2{padding:0.5rem}.p-3{padding:0.75rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-2{padding-left:0.5rem;padding-right:0.5rem}.px-3{padding-left:0.75rem;padding-right:0.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.px-8{padding-left:2rem;padding-right:2rem}.py-1{padding-top:0.25rem;padding-bottom:0.25rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.py-5{padding-top:1.25rem;padding-bottom:1.25rem}.pb-1{padding-bottom:0.25rem}.pb-3{padding-bottom:0.75rem}.pt-1{padding-top:0.25rem}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.align-middle{vertical-align:middle}.font-serif{font-family:ui-serif, Georgia, Cambria, "Times New Roman", Times, serif}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-5xl{font-size:3rem;line-height:1}.text-8xl{font-size:6rem;line-height:1}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.uppercase{text-transform:uppercase}.italic{font-style:italic}.leading-relaxed{line-height:1.625}.leading-snug{line-height:1.375}.tracking-wide{letter-spacing:0.025em}.tracking-wider{letter-spacing:0.05em}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-\[\#4e342e\]{--tw-text-opacity:1;color:rgb(78 52 46 / var(--tw-text-opacity, 1))}.text-blue-400{--tw-text-opacity:1;color:rgb(96 165 250 / var(--tw-text-opacity, 1))}.text-blue-800{--tw-text-opacity:1;color:rgb(30 64 175 / var(--tw-text-opacity, 1))}.text-gray-300{--tw-text-opacity:1;color:rgb(209 213 219 / var(--tw-text-opacity, 1))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.text-green-400{--tw-text-opacity:1;color:rgb(74 222 128 / var(--tw-text-opacity, 1))}.text-green-500{--tw-text-opacity:1;color:rgb(34 197 94 / var(--tw-text-opacity, 1))}.text-red-600{--tw-text-opacity:1;color:rgb(220 38 38 / var(--tw-text-opacity, 1))}.text-red-700{--tw-text-opacity:1;color:rgb(185 28 28 / var(--tw-text-opacity, 1))}.text-red-800{--tw-text-opacity:1;color:rgb(153 27 27 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-yellow-200{--tw-text-opacity:1;color:rgb(254 240 138 / var(--tw-text-opacity, 1))}.text-yellow-300{--tw-text-opacity:1;color:rgb(253 224 71 / var(--tw-text-opacity, 1))}.text-yellow-400{--tw-text-opacity:1;color:rgb(250 204 21 / var(--tw-text-opacity, 1))}.text-yellow-500{--tw-text-opacity:1;color:rgb(234 179 8 / var(--tw-text-opacity, 1))}.text-yellow-700{--tw-text-opacity:1;color:rgb(161 98 7 / var(--tw-text-opacity, 1))}.text-yellow-800{--tw-text-opacity:1;color:rgb(133 77 14 / var(--tw-text-opacity, 1))}.text-yellow-900{--tw-text-opacity:1;color:rgb(113 63 18 / var(--tw-text-opacity, 1))}.text-green-600{--tw-text-opacity:1;color:rgb(22 163 74 / var(--tw-text-opacity, 1))}.opacity-50{opacity:0.5}.opacity-80{opacity:0.8}.opacity-90{opacity:0.9}.shadow{--tw-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgb(0 0 0 / 0.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-inner{--tw-shadow:inset 0 2px 4px 0 rgb(0 0 0 / 0.05);--tw-shadow-colored:inset 0 2px 4px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgb(0 0 0 / 0.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.outline-none{outline:2px solid transparent;outline-offset:2px}.drop-shadow-2xl{--tw-drop-shadow:drop-shadow(0 25px 25px rgb(0 0 0 / 0.15));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.drop-shadow-lg{--tw-drop-shadow:drop-shadow(0 10px 8px rgb(0 0 0 / 0.04)) drop-shadow(0 4px 3px rgb(0 0 0 / 0.1));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.drop-shadow-md{--tw-drop-shadow:drop-shadow(0 4px 3px rgb(0 0 0 / 0.07)) drop-shadow(0 2px 2px rgb(0 0 0 / 0.06));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.drop-shadow-sm{--tw-drop-shadow:drop-shadow(0 1px 1px rgb(0 0 0 / 0.05));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.grayscale{--tw-grayscale:grayscale(100%);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.backdrop-blur-sm{--tw-backdrop-blur:blur(4px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition{transition-property:color, background-color, border-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-colors{transition-property:color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.duration-300{transition-duration:300ms}.duration-500{transition-duration:500ms}.ease-in-out{transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1)}.hover\:scale-105:hover{--tw-scale-x:1.05;--tw-scale-y:1.05;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-800:hover{--tw-bg-opacity:1;background-color:rgb(30 64 175 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-600:hover{--tw-bg-opacity:1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.hover\:bg-green-700:hover{--tw-bg-opacity:1;background-color:rgb(21 128 61 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-700:hover{--tw-bg-opacity:1;background-color:rgb(126 34 206 / var(--tw-bg-opacity, 1))}.hover\:bg-red-600:hover{--tw-bg-opacity:1;background-color:rgb(220 38 38 / var(--tw-bg-opacity, 1))}.hover\:bg-red-700:hover{--tw-bg-opacity:1;background-color:rgb(185 28 28 / var(--tw-bg-opacity, 1))}.hover\:bg-white\/40:hover{background-color:rgb(255 255 255 / 0.4)}.hover\:bg-yellow-700:hover{--tw-bg-opacity:1;background-color:rgb(161 98 7 / var(--tw-bg-opacity, 1))}.hover\:bg-yellow-800:hover{--tw-bg-opacity:1;background-color:rgb(133 77 14 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-100:hover{--tw-bg-opacity:1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1))}.hover\:text-red-500:hover{--tw-text-opacity:1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}.hover\:text-red-600:hover{--tw-text-opacity:1;color:rgb(220 38 38 / var(--tw-text-opacity, 1))}.focus\:border-yellow-600:focus{--tw-border-opacity:1;border-color:rgb(202 138 4 / var(--tw-border-opacity, 1))}.active\:scale-95:active{--tw-scale-x:.95;--tw-scale-y:.95;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.group:hover .group-hover\:scale-110{--tw-scale-x:1.1;--tw-scale-y:1.1;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.group:hover .group-hover\:text-red-700{--tw-text-opacity:1;color:rgb(185 28 28 / var(--tw-text-opacity, 1))}@media (min-width: 640px){.sm\:text-3xl{font-size:1.875rem;line-height:2.25rem}.sm\:text-xl{font-size:1.25rem;line-height:1.75rem}}@media (min-width: 768px){.md\:mx-12{margin-left:3rem;margin-right:3rem}.md\:block{display:block}.md\:inline{display:inline}.md\:h-16{height:4rem}.md\:h-24{height:6rem}.md\:h-28{height:7rem}.md\:h-60{height:15rem}.md\:w-16{width:4rem}.md\:w-24{width:6rem}.md\:w-28{width:7rem}.md\:w-60{width:15rem}.md\:w-\[600px\]{width:600px}.md\:w-auto{width:auto}.md\:flex-row{flex-direction:row}.md\:gap-3{gap:0.75rem}.md\:gap-8{gap:2rem}.md\:p-10{padding:2.5rem}.md\:p-12{padding:3rem}.md\:p-4{padding:1rem}.md\:p-6{padding:1.5rem}.md\:px-6{padding-left:1.5rem;padding-right:1.5rem}.md\:text-2xl{font-size:1.5rem;line-height:2rem}.md\:text-3xl{font-size:1.875rem;line-height:2.25rem}.md\:text-4xl{font-size:2.25rem;line-height:2.5rem}.md\:text-5xl{font-size:3rem;line-height:1}.md\:text-7xl{font-size:4.5rem;line-height:1}.md\:text-lg{font-size:1.125rem;line-height:1.75rem}.md\:text-xl{font-size:1.25rem;line-height:1.75rem}}</style></head>
<body class="text-gray-800 flex flex-col">

    <!-- AUDIO SYSTEM -->
    <audio id="bg-music" loop="">
        <source src="https://opengameart.org/sites/default/files/The%20Buccaneers%20Haul.mp3" type="audio/mpeg">
    </audio>
    <audio id="sfx-correct">
        <source src="https://opengameart.org/sites/default/files/picked_coin_echo_2.wav" type="audio/wav">
    </audio>
    <audio id="sfx-wrong">
        <source src="https://opengameart.org/sites/default/files/error_0.wav" type="audio/wav">
    </audio>
    <audio id="sfx-win">
        <source src="https://opengameart.org/sites/default/files/win_2.wav" type="audio/wav">
    </audio>
    <audio id="sfx-travel">
        <source src="https://opengameart.org/sites/default/files/wind.wav" type="audio/wav">
    </audio>

    <!-- VIDEO INTRO MODAL -->
    <div id="video-intro-modal" class="fixed inset-0 bg-black z-[100] hidden flex-col items-center justify-center">
        <video id="intro-video-element" class="w-full h-full max-h-screen object-contain bg-black" controls="" playsinline=""></video>
        <button id="skip-video-btn" class="absolute top-4 right-4 bg-white/20 hover:bg-white/40 text-white px-4 py-2 rounded-full border border-white font-bold transition-colors z-[101]">
            Bỏ Qua Intro <svg class="svg-inline--fa fa-forward" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="forward" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M52.5 440.6c-9.5 7.9-22.8 9.7-34.1 4.4S0 428.4 0 416V96C0 83.6 7.2 72.3 18.4 67s24.5-3.6 34.1 4.4L224 214.3V256v41.7L52.5 440.6zM256 352V256 128 96c0-12.4 7.2-23.7 18.4-29s24.5-3.6 34.1 4.4l192 160c7.3 6.1 11.5 15.1 11.5 24.6s-4.2 18.5-11.5 24.6l-192 160c-9.5 7.9-22.8 9.7-34.1 4.4s-18.4-16.6-18.4-29V352z"></path></svg><!-- <i class="fas fa-forward"></i> Font Awesome fontawesome.com -->
        </button>
        <div id="manual-play-overlay" class="hidden absolute inset-0 bg-black/50 z-[102] flex items-center justify-center">
            <button id="manual-play-btn" class="bg-yellow-600 hover:bg-yellow-700 text-white px-8 py-4 rounded-full text-2xl font-bold animate-pulse shadow-2xl border-4 border-white">
                <svg class="svg-inline--fa fa-play" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" data-fa-i2svg=""><path fill="currentColor" d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"></path></svg><!-- <i class="fas fa-play"></i> Font Awesome fontawesome.com --> BẮT ĐẦU NGAY
            </button>
        </div>
    </div>

    <!-- STAGE INTRO OVERLAY -->
    <div id="stage-intro-modal" class="fixed inset-0 bg-black z-[90] hidden flex-col items-center justify-center transition-opacity duration-500">
        <img id="stage-intro-img" src="" class="w-full h-full object-cover animate-zoom-in opacity-90">
        <div class="absolute bottom-16 bg-black/70 text-white text-4xl font-hand font-bold px-8 py-4 rounded-full border-4 border-yellow-500 animate-bounce shadow-2xl">
            <span id="stage-intro-text">Cửa Ải X</span>
        </div>
    </div>

    <!-- HEADER -->
    <div class="bg-gray-900 text-white p-2 flex justify-between items-center z-50 shadow-md shrink-0">
        <div class="flex items-center gap-2">
            <svg class="svg-inline--fa fa-anchor text-yellow-500 text-2xl" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="anchor" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M320 96a32 32 0 1 1 -64 0 32 32 0 1 1 64 0zm21.1 80C367 158.8 384 129.4 384 96c0-53-43-96-96-96s-96 43-96 96c0 33.4 17 62.8 42.9 80H224c-17.7 0-32 14.3-32 32s14.3 32 32 32h32V448H208c-53 0-96-43-96-96v-6.1l7 7c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9L97 263c-9.4-9.4-24.6-9.4-33.9 0L7 319c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l7-7V352c0 88.4 71.6 160 160 160h80 80c88.4 0 160-71.6 160-160v-6.1l7 7c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-56-56c-9.4-9.4-24.6-9.4-33.9 0l-56 56c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l7-7V352c0 53-43 96-96 96H320V240h32c17.7 0 32-14.3 32-32s-14.3-32-32-32H341.1z"></path></svg><!-- <i class="fas fa-anchor text-yellow-500 text-2xl"></i> Font Awesome fontawesome.com -->
            <span class="font-bold text-lg hidden md:block">Toán 10: Vectơ</span>
            <span id="cloud-status" class="text-xs text-green-500 ml-2" title="Trạng thái kết nối"><svg class="svg-inline--fa fa-wifi" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="wifi" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" data-fa-i2svg=""><path fill="currentColor" d="M54.2 202.9C123.2 136.7 216.8 96 320 96s196.8 40.7 265.8 106.9c12.8 12.2 33 11.8 45.2-.9s11.8-33-.9-45.2C549.7 79.5 440.4 32 320 32S90.3 79.5 9.8 156.7C-2.9 169-3.3 189.2 8.9 202s32.5 13.2 45.2 .9zM320 256c56.8 0 108.6 21.1 148.2 56c13.3 11.7 33.5 10.4 45.2-2.8s10.4-33.5-2.8-45.2C459.8 219.2 393 192 320 192s-139.8 27.2-190.5 72c-13.3 11.7-14.5 31.9-2.8 45.2s31.9 14.5 45.2 2.8c39.5-34.9 91.3-56 148.2-56zm64 160a64 64 0 1 0 -128 0 64 64 0 1 0 128 0z"></path></svg><!-- <i class="fas fa-wifi"></i> Font Awesome fontawesome.com --> Online</span>
        </div>
        <div class="flex gap-2 items-center">
            <button onclick="downloadGame()" id="btn-download-game" class="bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-xs" title="Tải game về máy" disabled=""><svg class="svg-inline--fa fa-spinner fa-spin" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="spinner" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M304 48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zm0 416a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM48 304a48 48 0 1 0 0-96 48 48 0 1 0 0 96zm464-48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM142.9 437A48 48 0 1 0 75 369.1 48 48 0 1 0 142.9 437zm0-294.2A48 48 0 1 0 75 75a48 48 0 1 0 67.9 67.9zM369.1 437A48 48 0 1 0 437 369.1 48 48 0 1 0 369.1 437z"></path></svg><!-- <i class="fas fa-spinner fa-spin"></i> Font Awesome fontawesome.com --> Đang đóng gói...</button>

            <!-- Đã lược bỏ nút Upload Video, Upload Nhạc và Thanh Volume theo yêu cầu -->

            <button onclick="toggleTeacherPanel()" class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-xs relative">
                <svg class="svg-inline--fa fa-chalkboard-user" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="chalkboard-user" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" data-fa-i2svg=""><path fill="currentColor" d="M160 64c0-35.3 28.7-64 64-64H576c35.3 0 64 28.7 64 64V352c0 35.3-28.7 64-64 64H336.8c-11.8-25.5-29.9-47.5-52.4-64H384V320c0-17.7 14.3-32 32-32h64c17.7 0 32 14.3 32 32v32h64V64L224 64v49.1C205.2 102.2 183.3 96 160 96V64zm0 64a96 96 0 1 1 0 192 96 96 0 1 1 0-192zM133.3 352h53.3C260.3 352 320 411.7 320 485.3c0 14.7-11.9 26.7-26.7 26.7H26.7C11.9 512 0 500.1 0 485.3C0 411.7 59.7 352 133.3 352z"></path></svg><!-- <i class="fas fa-chalkboard-teacher"></i> Font Awesome fontawesome.com --> <span class="hidden md:inline">Giáo viên</span>
                <span id="live-indicator" class="hidden absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-ping"></span>
            </button>
            <button onclick="toggleMusic()" class="bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded text-xs w-8 text-center" title="Bật/Tắt nhạc">
                <svg id="music-icon" class="svg-inline--fa fa-volume-xmark" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="volume-xmark" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M301.1 34.8C312.6 40 320 51.4 320 64V448c0 12.6-7.4 24-18.9 29.2s-25 3.1-34.4-5.3L131.8 352H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64h67.8L266.7 40.1c9.4-8.4 22.9-10.4 34.4-5.3zM425 167l55 55 55-55c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-55 55 55 55c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-55-55-55 55c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l55-55-55-55c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0z"></path></svg><!-- <i id="music-icon" class="fas fa-volume-mute"></i> Font Awesome fontawesome.com -->
            </button>
        </div>
    </div>

    <!-- MAIN APP CONTAINER -->
    <main id="app-container" class="flex-grow relative overflow-hidden h-full">
        
        <!-- SCREEN 1: LOGIN -->
        <div id="screen-login" class="absolute inset-0 bg-gray-800 flex items-center justify-center z-40 map-bg">
            <div class="bg-white/90 backdrop-blur-sm p-8 rounded-xl shadow-2xl max-w-md w-full border-4 border-yellow-600 text-center m-4">
                <h1 class="text-4xl md:text-5xl text-yellow-800 mb-2 drop-shadow-md font-bold" style="font-family: 'Times New Roman', serif;">TRUY TÌM KHO BÁU</h1>
                <p class="mb-6 text-gray-700 italic text-lg md:text-xl">"Chào mừng thuyền trưởng! Nhập danh tính để hệ thống ghi nhận."</p>
                <div class="space-y-4">
                    <input type="text" id="input-name" class="w-full p-3 text-lg border-2 border-gray-400 rounded-lg focus:border-yellow-600 outline-none shadow-inner" placeholder="Nhập họ tên thuyền trưởng..." onkeypress="if(event.key === 'Enter') startGame()">
                    <input type="text" id="input-class" class="w-full p-3 text-lg border-2 border-gray-400 rounded-lg focus:border-yellow-600 outline-none shadow-inner" placeholder="Số hiệu tàu (Lớp - VD: 10A1)" onkeypress="if(event.key === 'Enter') startGame()">
                    <button onclick="startGame()" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-4 rounded-lg shadow-xl transform transition active:scale-95 text-xl md:text-2xl font-hand uppercase">
                        RA KHƠI NGAY <svg class="svg-inline--fa fa-ship ml-2" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="ship" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M192 32c0-17.7 14.3-32 32-32H352c17.7 0 32 14.3 32 32V64h48c26.5 0 48 21.5 48 48V240l44.4 14.8c23.1 7.7 29.5 37.5 11.5 53.9l-101 92.6c-16.2 9.4-34.7 15.1-50.9 15.1c-19.6 0-40.8-7.7-59.2-20.3c-22.1-15.5-51.6-15.5-73.7 0c-17.1 11.8-38 20.3-59.2 20.3c-16.2 0-34.7-5.7-50.9-15.1l-101-92.6c-18-16.5-11.6-46.2 11.5-53.9L96 240V112c0-26.5 21.5-48 48-48h48V32zM160 218.7l107.8-35.9c13.1-4.4 27.3-4.4 40.5 0L416 218.7V128H160v90.7zM306.5 421.9C329 437.4 356.5 448 384 448c26.9 0 55.4-10.8 77.4-26.1l0 0c11.9-8.5 28.1-7.8 39.2 1.7c14.4 11.9 32.5 21 50.6 25.2c17.2 4 27.9 21.2 23.9 38.4s-21.2 27.9-38.4 23.9c-24.5-5.7-44.9-16.5-58.2-25C449.5 501.7 417 512 384 512c-31.9 0-60.6-9.9-80.4-18.9c-5.8-2.7-11.1-5.3-15.6-7.7c-4.5 2.4-9.7 5.1-15.6 7.7c-19.8 9-48.5 18.9-80.4 18.9c-33 0-65.5-10.3-94.5-25.8c-13.4 8.4-33.7 19.3-58.2 25c-17.2 4-34.4-6.7-38.4-23.9s6.7-34.4 23.9-38.4c18.1-4.2 36.2-13.3 50.6-25.2c11.1-9.4 27.3-10.1 39.2-1.7l0 0C136.7 437.2 165.1 448 192 448c27.5 0 55-10.6 77.5-26.1c11.1-7.9 25.9-7.9 37 0z"></path></svg><!-- <i class="fas fa-ship ml-2"></i> Font Awesome fontawesome.com -->
                    </button>
                </div>
            </div>
        </div>

        <!-- SCREEN 1.5: MISSION BRIEFING (Màn hình mới thêm vào) -->
        <div id="screen-mission" class="absolute inset-0 hidden z-50 flex items-center justify-center bg-gray-900/95 backdrop-blur-sm p-2 md:p-4 map-bg">
            <div class="parchment-modal max-w-3xl w-full p-6 md:p-12 relative flex flex-col items-center animate-fade-in-up shadow-2xl border-4 border-yellow-800">
                <!-- Icon hoặc hình ảnh trang trí -->
                <div class="absolute -top-10 -right-10 hidden md:block">
                     <svg class="svg-inline--fa fa-compass text-8xl text-yellow-700 drop-shadow-lg opacity-80 fa-spin" style="animation-duration: 10s;" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="compass" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zm50.7-186.9L162.4 380.6c-19.4 7.5-38.5-11.6-31-31l55.5-144.3c3.3-8.5 9.9-15.1 18.4-18.4l144.3-55.5c19.4-7.5 38.5 11.6 31 31L325.1 306.7c-3.2 8.5-9.9 15.1-18.4 18.4zM288 256a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z"></path></svg><!-- <i class="fas fa-compass text-8xl text-yellow-700 drop-shadow-lg opacity-80 fa-spin" style="animation-duration: 10s;"></i> Font Awesome fontawesome.com -->
                </div>
                
                <h2 class="text-2xl sm:text-3xl md:text-5xl font-pirate text-red-800 mb-6 text-center drop-shadow-md whitespace-nowrap tracking-wider" style="text-shadow: 2px 2px 0px rgba(255,230,200, 0.5);">Chào mừng thuyền trưởng!</h2>
                
                <div class="text-lg md:text-2xl font-hand font-bold text-[#4e342e] text-center leading-relaxed mission-text-shadow w-full">
                    <p class="mb-6">
                        Kho báu tri thức đang ẩn giấu tại tọa độ X. Để đến được đó, bạn phải thu thập đủ 
                        <span class="inline-block bg-yellow-200/50 px-3 py-1 rounded-lg border-2 border-yellow-600 border-dashed transform rotate-1 mx-1 align-middle shadow-sm hover:scale-105 transition-transform cursor-default">
                            <span class="text-red-700 text-xl md:text-3xl font-pirate whitespace-nowrap">4 Mảnh Chìa Khóa</span>
                        </span>
                    </p>

                    <div class="mt-8 mx-0 md:mx-12 py-5 px-4 md:px-6 bg-white/60 rounded-xl border-y-4 border-double border-blue-300 shadow-lg relative overflow-visible group w-full md:w-auto">
                        <svg class="svg-inline--fa fa-quote-left absolute -top-4 -left-2 text-blue-400 text-3xl md:text-4xl opacity-50 transform -rotate-12 group-hover:scale-110 transition-transform" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="quote-left" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M0 216C0 149.7 53.7 96 120 96h8c17.7 0 32 14.3 32 32s-14.3 32-32 32h-8c-30.9 0-56 25.1-56 56v8h64c35.3 0 64 28.7 64 64v64c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V320 288 216zm256 0c0-66.3 53.7-120 120-120h8c17.7 0 32 14.3 32 32s-14.3 32-32 32h-8c-30.9 0-56 25.1-56 56v8h64c35.3 0 64 28.7 64 64v64c0 35.3-28.7 64-64 64H320c-35.3 0-64-28.7-64-64V320 288 216z"></path></svg><!-- <i class="fas fa-quote-left absolute -top-4 -left-2 text-blue-400 text-3xl md:text-4xl opacity-50 transform -rotate-12 group-hover:scale-110 transition-transform"></i> Font Awesome fontawesome.com -->
                        
                        <div class="font-serif flex flex-col gap-2 md:gap-3 items-center">
                            <span class="text-gray-600 italic text-base md:text-lg text-left border-b border-blue-100 pb-1 w-fit">"Hãy nhớ:</span>
                            <span class="text-blue-800 font-bold text-lg sm:text-xl md:text-3xl drop-shadow-sm tracking-wide whitespace-nowrap">Vectơ là kim chỉ nam</span>
                            <span class="text-red-600 font-bold text-lg sm:text-xl md:text-3xl drop-shadow-sm tracking-wide whitespace-nowrap group-hover:text-red-700 transition-colors">Sai hướng là lạc lối</span>
                        </div>
                        
                        <svg class="svg-inline--fa fa-quote-right absolute -bottom-4 -right-2 text-blue-400 text-3xl md:text-4xl opacity-50 transform rotate-12 group-hover:scale-110 transition-transform" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="quote-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M448 296c0 66.3-53.7 120-120 120h-8c-17.7 0-32-14.3-32-32s14.3-32 32-32h8c30.9 0 56-25.1 56-56v-8H320c-35.3 0-64-28.7-64-64V160c0-35.3 28.7-64 64-64h64c35.3 0 64 28.7 64 64v32 32 72zm-256 0c0 66.3-53.7 120-120 120H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h8c30.9 0 56-25.1 56-56v-8H64c-35.3 0-64-28.7-64-64V160c0-35.3 28.7-64 64-64h64c35.3 0 64 28.7 64 64v32 32 72z"></path></svg><!-- <i class="fas fa-quote-right absolute -bottom-4 -right-2 text-blue-400 text-3xl md:text-4xl opacity-50 transform rotate-12 group-hover:scale-110 transition-transform"></i> Font Awesome fontawesome.com -->
                    </div>
                </div>

                <!-- Visual 4 mảnh chìa khóa giống trong hình -->
                <div class="flex justify-center gap-4 md:gap-8 my-8 w-full">
                    <div class="flex flex-col items-center group">
                        <div class="w-14 h-14 md:w-16 md:h-16 bg-gradient-to-br from-yellow-300 to-yellow-600 rounded-lg border-4 border-yellow-800 flex items-center justify-center shadow-lg transform rotate-3 group-hover:scale-110 transition-transform">
                            <svg class="svg-inline--fa fa-key text-white text-2xl drop-shadow-md" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="key" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M336 352c97.2 0 176-78.8 176-176S433.2 0 336 0S160 78.8 160 176c0 18.7 2.9 36.8 8.3 53.7L7 391c-4.5 4.5-7 10.6-7 17v80c0 13.3 10.7 24 24 24h80c13.3 0 24-10.7 24-24V448h40c13.3 0 24-10.7 24-24V384h40c6.4 0 12.5-2.5 17-7l33.3-33.3c16.9 5.4 35 8.3 53.7 8.3zM376 96a40 40 0 1 1 0 80 40 40 0 1 1 0-80z"></path></svg><!-- <i class="fas fa-key text-white text-2xl drop-shadow-md"></i> Font Awesome fontawesome.com -->
                        </div>
                        <span class="font-hand font-bold text-brown-800 mt-2 text-sm">Mảnh 1</span>
                    </div>
                    <div class="flex flex-col items-center group">
                         <div class="w-14 h-14 md:w-16 md:h-16 bg-gradient-to-br from-yellow-300 to-yellow-600 rounded-lg border-4 border-yellow-800 flex items-center justify-center shadow-lg transform -rotate-2 group-hover:scale-110 transition-transform opacity-50 grayscale">
                            <svg class="svg-inline--fa fa-key text-white text-2xl drop-shadow-md" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="key" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M336 352c97.2 0 176-78.8 176-176S433.2 0 336 0S160 78.8 160 176c0 18.7 2.9 36.8 8.3 53.7L7 391c-4.5 4.5-7 10.6-7 17v80c0 13.3 10.7 24 24 24h80c13.3 0 24-10.7 24-24V448h40c13.3 0 24-10.7 24-24V384h40c6.4 0 12.5-2.5 17-7l33.3-33.3c16.9 5.4 35 8.3 53.7 8.3zM376 96a40 40 0 1 1 0 80 40 40 0 1 1 0-80z"></path></svg><!-- <i class="fas fa-key text-white text-2xl drop-shadow-md"></i> Font Awesome fontawesome.com -->
                        </div>
                        <span class="font-hand font-bold text-brown-800 mt-2 text-sm">Mảnh 2</span>
                    </div>
                    <div class="flex flex-col items-center group">
                         <div class="w-14 h-14 md:w-16 md:h-16 bg-gradient-to-br from-yellow-300 to-yellow-600 rounded-lg border-4 border-yellow-800 flex items-center justify-center shadow-lg transform rotate-1 group-hover:scale-110 transition-transform opacity-50 grayscale">
                            <svg class="svg-inline--fa fa-key text-white text-2xl drop-shadow-md" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="key" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M336 352c97.2 0 176-78.8 176-176S433.2 0 336 0S160 78.8 160 176c0 18.7 2.9 36.8 8.3 53.7L7 391c-4.5 4.5-7 10.6-7 17v80c0 13.3 10.7 24 24 24h80c13.3 0 24-10.7 24-24V448h40c13.3 0 24-10.7 24-24V384h40c6.4 0 12.5-2.5 17-7l33.3-33.3c16.9 5.4 35 8.3 53.7 8.3zM376 96a40 40 0 1 1 0 80 40 40 0 1 1 0-80z"></path></svg><!-- <i class="fas fa-key text-white text-2xl drop-shadow-md"></i> Font Awesome fontawesome.com -->
                        </div>
                        <span class="font-hand font-bold text-brown-800 mt-2 text-sm">Mảnh 3</span>
                    </div>
                    <div class="flex flex-col items-center group">
                         <div class="w-14 h-14 md:w-16 md:h-16 bg-gradient-to-br from-yellow-300 to-yellow-600 rounded-lg border-4 border-yellow-800 flex items-center justify-center shadow-lg transform -rotate-3 group-hover:scale-110 transition-transform opacity-50 grayscale">
                            <svg class="svg-inline--fa fa-key text-white text-2xl drop-shadow-md" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="key" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M336 352c97.2 0 176-78.8 176-176S433.2 0 336 0S160 78.8 160 176c0 18.7 2.9 36.8 8.3 53.7L7 391c-4.5 4.5-7 10.6-7 17v80c0 13.3 10.7 24 24 24h80c13.3 0 24-10.7 24-24V448h40c13.3 0 24-10.7 24-24V384h40c6.4 0 12.5-2.5 17-7l33.3-33.3c16.9 5.4 35 8.3 53.7 8.3zM376 96a40 40 0 1 1 0 80 40 40 0 1 1 0-80z"></path></svg><!-- <i class="fas fa-key text-white text-2xl drop-shadow-md"></i> Font Awesome fontawesome.com -->
                        </div>
                        <span class="font-hand font-bold text-brown-800 mt-2 text-sm">Mảnh 4</span>
                    </div>
                </div>

                <button onclick="closeMissionScreen()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-full text-xl md:text-2xl shadow-xl transform transition hover:scale-105 active:scale-95 border-4 border-red-800 animate-pulse">
                    ĐÃ RÕ, XUẤT PHÁT! <svg class="svg-inline--fa fa-map-location-dot ml-2" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="map-location-dot" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M408 120c0 54.6-73.1 151.9-105.2 192c-7.7 9.6-22 9.6-29.6 0C241.1 271.9 168 174.6 168 120C168 53.7 221.7 0 288 0s120 53.7 120 120zm8 80.4c3.5-6.9 6.7-13.8 9.6-20.6c.5-1.2 1-2.5 1.5-3.7l116-46.4C558.9 123.4 576 135 576 152V422.8c0 9.8-6 18.6-15.1 22.3L416 503V200.4zM137.6 138.3c2.4 14.1 7.2 28.3 12.8 41.5c2.9 6.8 6.1 13.7 9.6 20.6V451.8L32.9 502.7C17.1 509 0 497.4 0 480.4V209.6c0-9.8 6-18.6 15.1-22.3l122.6-49zM327.8 332c13.9-17.4 35.7-45.7 56.2-77V504.3L192 449.4V255c20.5 31.3 42.3 59.6 56.2 77c20.5 25.6 59.1 25.6 79.6 0zM288 152a40 40 0 1 0 0-80 40 40 0 1 0 0 80z"></path></svg><!-- <i class="fas fa-map-marked-alt ml-2"></i> Font Awesome fontawesome.com -->
                </button>
            </div>
        </div>

        <!-- SCREEN 2: MAP -->
        <div id="screen-map" class="absolute inset-0 hidden z-30 map-bg">
            <div class="absolute top-4 left-4 bg-black/70 text-white p-4 rounded-xl border-2 border-yellow-500 z-50 shadow-lg pointer-events-none">
                <p class="font-bold text-lg text-yellow-200"><svg class="svg-inline--fa fa-circle-user" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle-user" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M399 384.2C376.9 345.8 335.4 320 288 320H224c-47.4 0-88.9 25.8-111 64.2c35.2 39.2 86.2 63.8 143 63.8s107.8-24.7 143-63.8zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm256 16a72 72 0 1 0 0-144 72 72 0 1 0 0 144z"></path></svg><!-- <i class="fas fa-user-circle"></i> Font Awesome fontawesome.com --> <span id="display-name">...</span></p>
                <p class="text-sm text-gray-300"><svg class="svg-inline--fa fa-flag" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="flag" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M64 32C64 14.3 49.7 0 32 0S0 14.3 0 32V64 368 480c0 17.7 14.3 32 32 32s32-14.3 32-32V352l64.3-16.1c41.1-10.3 84.6-5.5 122.5 13.4c44.2 22.1 95.5 24.8 141.7 7.4l34.7-13c12.5-4.7 20.8-16.6 20.8-30V66.1c0-23-24.2-38-44.8-27.7l-9.6 4.8c-46.3 23.2-100.8 23.2-147.1 0c-35.1-17.6-75.4-22-113.5-12.5L64 48V32z"></path></svg><!-- <i class="fas fa-flag"></i> Font Awesome fontawesome.com --> <span id="display-class">...</span></p>
                <p class="text-yellow-400 font-bold text-xl mt-2 border-t border-gray-600 pt-1">ĐIỂM: <span id="score-display" class="text-3xl text-green-400">0</span>/10</p>
                <p class="text-xs text-gray-300 mt-1">Đã xong: <span id="stages-completed-count">0</span>/4 đảo</p>
            </div>

            <div id="story-box" class="absolute bottom-10 left-1/2 transform -translate-x-1/2 bg-yellow-100/95 p-6 rounded-xl border-4 border-yellow-800 shadow-2xl max-w-3xl w-11/12 text-center hidden z-50">
                <p id="story-text" class="text-2xl font-hand font-bold text-brown-900 leading-relaxed"></p>
                <button onclick="closeStory()" class="mt-4 bg-yellow-700 text-white px-6 py-2 rounded-full hover:bg-yellow-800 text-lg font-bold shadow-md border-2 border-yellow-500">Đã rõ!</button>
            </div>

            <svg class="absolute inset-0 w-full h-full pointer-events-none" style="z-index: 10;">
                <path d="M 15% 35% Q 15% 75% 35% 70% T 65% 30% T 75% 55%" fill="none" stroke="#5d4037" stroke-width="4" stroke-dasharray="10,5" style="filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.5)); opacity: 0.6;"></path>
            </svg>

            <img id="player-character" src="https://yt3.ggpht.com/6vOPk8ILkUCjeWmBuHllSDmAuIMtXdl_ZWyMdLTCdYUxnha5tT7eV9xGJ2PqtYyGRZ1dgt0esU9jmuY=s612-rw-nd-v1" class="absolute w-40 h-40 md:w-60 md:h-60 object-contain z-50 drop-shadow-2xl transition-all duration-1500 ease-in-out" style="top: 50%; left: 50%; transform: translate(-50%, -80%);">

            <!-- Các node -->
            <div id="node-1" class="stage-node absolute" style="left: 15%; top: 35%;" onclick="enterStage(1)">
                <div class="relative group floating">
                    <div class="w-20 h-20 md:w-24 md:h-24 rounded-full border-4 border-white shadow-lg overflow-hidden bg-white">
                        <img src="https://yt3.ggpht.com/UEPzGUr8PNahyh7Tbi__vMQjpJQnzMonJRDyFXZvY8yrRABoEbFxiGRtdqWAueS_wGYPV3czKYF3=s800-c-fcrop64=1,3a2e0000c5d1ffff-rw-nd-v1" class="w-full h-full object-cover">
                    </div>
                    <div class="absolute -bottom-8 left-1/2 transform -translate-x-1/2 bg-black/80 text-white text-xs px-2 py-1 rounded whitespace-nowrap font-bold border border-yellow-500 z-50">Trạm 1</div>
                    <div class="check-mark hidden absolute top-0 right-0 text-green-500 bg-white rounded-full p-1 text-xl border-2 border-green-500 z-50"><svg class="svg-inline--fa fa-check" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="check" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg><!-- <i class="fas fa-check"></i> Font Awesome fontawesome.com --></div>
                </div>
            </div>
            
            <div id="node-2" class="stage-node absolute" style="left: 35%; top: 70%;" onclick="enterStage(2)">
                <div class="relative group floating" style="animation-delay: 0.5s;">
                    <div class="w-20 h-20 md:w-24 md:h-24 rounded-full border-4 border-white shadow-lg overflow-hidden bg-white">
                        <img src="https://yt3.ggpht.com/03sVv970v2tE6V3aDd63x1F_Ugop1dRf2iq4I60vjHNUsUDXppyXiJTQ9gD-1WzlgzCwPFnWXqAyuQ=s800-c-fcrop64=1,3a2e0000c5d1ffff-rw-nd-v1" class="w-full h-full object-cover">
                    </div>
                    <div class="absolute -bottom-8 left-1/2 transform -translate-x-1/2 bg-black/80 text-white text-xs px-2 py-1 rounded whitespace-nowrap font-bold border border-blue-400 z-50">Trạm 2</div>
                    <div class="check-mark hidden absolute top-0 right-0 text-green-500 bg-white rounded-full p-1 text-xl border-2 border-green-500 z-50"><svg class="svg-inline--fa fa-check" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="check" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg><!-- <i class="fas fa-check"></i> Font Awesome fontawesome.com --></div>
                </div>
            </div>
            
            <div id="node-3" class="stage-node absolute" style="left: 65%; top: 30%;" onclick="enterStage(3)">
                <div class="relative group floating" style="animation-delay: 1s;">
                    <div class="w-20 h-20 md:w-24 md:h-24 rounded-full border-4 border-white shadow-lg overflow-hidden bg-white">
                        <img src="https://yt3.ggpht.com/IQ0wUC1F3NtdCDqCyb-iKdeaQTXOm7u1DRMTqjc8B65eZXZpgdl9aZIml0zsRWQtqlPZa0AwVthqwIE=s800-c-fcrop64=1,00002aabffffd555-rw-nd-v1" class="w-full h-full object-cover">
                    </div>
                    <div class="absolute -bottom-8 left-1/2 transform -translate-x-1/2 bg-black/80 text-white text-xs px-2 py-1 rounded whitespace-nowrap font-bold border border-purple-400 z-50">Trạm 3</div>
                    <div class="check-mark hidden absolute top-0 right-0 text-green-500 bg-white rounded-full p-1 text-xl border-2 border-green-500 z-50"><svg class="svg-inline--fa fa-check" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="check" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg><!-- <i class="fas fa-check"></i> Font Awesome fontawesome.com --></div>
                </div>
            </div>
            
            <div id="node-4" class="stage-node absolute" style="left: 75%; top: 55%;" onclick="enterStage(4)">
                <div class="relative group floating" style="animation-delay: 1.5s;">
                    <div class="w-24 h-24 md:w-28 md:h-28 rounded-full border-4 border-white shadow-lg overflow-hidden bg-white">
                        <img src="https://yt3.ggpht.com/v-gl1O97-eKlcPotcLdr6owy40M03uiS9XaL5tVNaEXGeTTSirGZqrIhSzs7nLitRZOMtShyGGcf=s800-c-fcrop64=1,49b20000b64dffff-rw-nd-v1" class="w-full h-full object-cover">
                    </div>
                    <div class="absolute -bottom-8 left-1/2 transform -translate-x-1/2 bg-black/80 text-white text-xs px-2 py-1 rounded whitespace-nowrap font-bold border border-red-400 z-50">Trạm 4</div>
                    <div class="check-mark hidden absolute top-0 right-0 text-green-500 bg-white rounded-full p-1 text-xl border-2 border-green-500 z-50"><svg class="svg-inline--fa fa-check" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="check" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg><!-- <i class="fas fa-check"></i> Font Awesome fontawesome.com --></div>
                </div>
            </div>
        </div>

        <!-- SCREEN 3: QUESTION MODAL -->
        <div id="modal-question" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50">
            <div class="parchment-modal w-full max-w-3xl mx-4 p-8 relative shadow-2xl animate-fade-in-up">
                <!-- NÚT ĐÓNG (X) ĐÃ ĐƯỢC ẨN -->
                <button onclick="closeModal()" class="hidden absolute top-4 right-4 text-brown-800 hover:text-red-600 text-3xl font-bold transition-colors w-10 h-10 flex items-center justify-center rounded-full bg-white/50">×</button>
                <div class="flex justify-between items-center mb-6 border-b-2 border-yellow-800/30 pb-3">
                    <h3 id="q-title" class="text-2xl md:text-3xl font-pirate text-yellow-900 drop-shadow-sm">Cửa Ải X</h3>
                    <div class="text-lg font-bold text-yellow-900 bg-yellow-200/50 px-3 py-1 rounded-full border border-yellow-600">Câu: <span id="q-progress">1/3</span></div>
                </div>
                <div id="q-content" class="mb-8 text-xl md:text-2xl leading-snug"></div>
                <div id="q-options" class="grid gap-4"></div>
                
                <div id="feedback-container" class="mt-6 flex flex-col md:flex-row items-center gap-4">
                    <div id="q-feedback" class="hidden flex-grow p-4 rounded-lg text-center border-2 shadow-inner w-full">
                        <p id="q-feedback-text" class="font-bold text-xl md:text-2xl font-pirate"></p>
                        <p id="q-explanation" class="text-lg mt-2 text-gray-800 font-medium hidden bg-white/50 p-2 rounded"></p>
                    </div>
                    
                    <button id="btn-next-q" onclick="nextQuestion()" class="hidden flex-shrink-0 bg-blue-700 hover:bg-blue-800 text-white px-6 py-4 rounded-lg font-bold shadow-lg transition-transform transform active:scale-95 text-lg uppercase tracking-wider border-2 border-blue-400 whitespace-nowrap w-full md:w-auto">
                        <span id="btn-next-text">Tiếp Tục</span> <svg class="svg-inline--fa fa-arrow-right ml-2" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M438.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L338.8 224 32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l306.7 0L233.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160z"></path></svg><!-- <i class="fas fa-arrow-right ml-2"></i> Font Awesome fontawesome.com -->
                    </button>
                </div>
            </div>
        </div>

        <!-- SCREEN 4: ROUND RESULT -->
        <div id="screen-result" class="absolute inset-0 bg-gray-900 hidden flex-col items-center justify-center z-50 text-white map-bg p-4">
            <div class="bg-black/85 p-6 md:p-10 rounded-2xl max-w-2xl w-full text-center border-4 border-yellow-500 relative shadow-2xl overflow-y-auto max-h-[90vh]">
                <div id="result-r1" class="hidden">
                    <h2 class="text-3xl md:text-5xl font-pirate text-yellow-400 mb-4 drop-shadow-lg">KẾT QUẢ CUỘC THI</h2>
                    <div id="badge-icon" class="text-5xl md:text-7xl my-4 animate-bounce"></div>
                    <h3 id="badge-title" class="text-2xl md:text-4xl font-bold text-white mb-3 uppercase tracking-wide">DANH HIỆU</h3>
                    <p id="badge-msg" class="text-gray-300 italic mb-6 text-xl">"Thông điệp..."</p>
                    <div class="bg-yellow-900/60 p-4 md:p-6 rounded-xl border-2 border-yellow-600 mb-8">
                        <p class="text-yellow-300 font-bold text-xl md:text-2xl mb-2">PHẦN THƯỞNG:</p>
                        <p id="badge-reward" class="text-white text-lg md:text-xl">...</p>
                    </div>
                    <div class="text-gray-400 text-sm italic mb-2"><svg class="svg-inline--fa fa-cloud-arrow-up" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="cloud-arrow-up" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" data-fa-i2svg=""><path fill="currentColor" d="M144 480C64.5 480 0 415.5 0 336c0-62.8 40.2-116.2 96.2-135.9c-.1-2.7-.2-5.4-.2-8.1c0-88.4 71.6-160 160-160c59.3 0 111 32.2 138.7 80.2C409.9 102 428.3 96 448 96c53 0 96 43 96 96c0 12.2-2.3 23.8-6.4 34.6C596 238.4 640 290.1 640 352c0 70.7-57.3 128-128 128H144zm79-217c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l39-39V392c0 13.3 10.7 24 24 24s24-10.7 24-24V257.9l39 39c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-80-80c-9.4-9.4-24.6-9.4-33.9 0l-80 80z"></path></svg><!-- <i class="fas fa-cloud-upload-alt"></i> Font Awesome fontawesome.com --> Đang lưu kết quả lên hệ thống...</div>
                    <p class="text-xl md:text-2xl mb-8">Tổng điểm: <span id="final-score-r1" class="font-bold text-green-400 text-3xl md:text-4xl"></span>/10</p>
                    <button onclick="location.reload()" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-4 rounded-full font-bold text-xl md:text-2xl shadow-xl animate-pulse border-4 border-blue-800 w-full md:w-auto">
                        VỀ NHÓM CỨU TRỢ <svg class="svg-inline--fa fa-life-ring ml-2" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="life-ring" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M367.2 412.5C335.9 434.9 297.5 448 256 448s-79.9-13.1-111.2-35.5l58-58c15.8 8.6 34 13.5 53.3 13.5s37.4-4.9 53.3-13.5l58 58zm90.7 .8c33.8-43.4 54-98 54-157.3s-20.2-113.9-54-157.3c9-12.5 7.9-30.1-3.4-41.3S425.8 45 413.3 54C369.9 20.2 315.3 0 256 0S142.1 20.2 98.7 54c-12.5-9-30.1-7.9-41.3 3.4S45 86.2 54 98.7C20.2 142.1 0 196.7 0 256s20.2 113.9 54 157.3c-9 12.5-7.9 30.1 3.4 41.3S86.2 467 98.7 458c43.4 33.8 98 54 157.3 54s113.9-20.2 157.3-54c12.5 9 30.1 7.9 41.3-3.4s12.4-28.8 3.4-41.3zm-45.5-46.1l-58-58c8.6-15.8 13.5-34 13.5-53.3s-4.9-37.4-13.5-53.3l58-58C434.9 176.1 448 214.5 448 256s-13.1 79.9-35.5 111.2zM367.2 99.5l-58 58c-15.8-8.6-34-13.5-53.3-13.5s-37.4 4.9-53.3 13.5l-58-58C176.1 77.1 214.5 64 256 64s79.9 13.1 111.2 35.5zM157.5 309.3l-58 58C77.1 335.9 64 297.5 64 256s13.1-79.9 35.5-111.2l58 58c-8.6 15.8-13.5 34-13.5 53.3s4.9 37.4 13.5 53.3zM208 256a48 48 0 1 1 96 0 48 48 0 1 1 -96 0z"></path></svg><!-- <i class="fas fa-life-ring ml-2"></i> Font Awesome fontawesome.com -->
                    </button>
                </div>
            </div>
        </div>

    </main>

    <!-- TEACHER PANEL -->
    <div id="teacher-panel" class="fixed right-0 top-0 bottom-0 w-full md:w-[600px] bg-white shadow-2xl transform transition-transform duration-300 z-[60] overflow-y-auto border-l-4 border-blue-600 translate-x-full">
        <div class="p-4">
            <div class="flex justify-between items-center mb-4 bg-blue-100 p-2 rounded">
                <h2 class="text-xl font-bold text-blue-800"><svg class="svg-inline--fa fa-database" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="database" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M448 80v48c0 44.2-100.3 80-224 80S0 172.2 0 128V80C0 35.8 100.3 0 224 0S448 35.8 448 80zM393.2 214.7c20.8-7.4 39.9-16.9 54.8-28.6V288c0 44.2-100.3 80-224 80S0 332.2 0 288V186.1c14.9 11.8 34 21.2 54.8 28.6C99.7 230.7 159.5 240 224 240s124.3-9.3 169.2-25.3zM0 346.1c14.9 11.8 34 21.2 54.8 28.6C99.7 390.7 159.5 400 224 400s124.3-9.3 169.2-25.3c20.8-7.4 39.9-16.9 54.8-28.6V432c0 44.2-100.3 80-224 80S0 476.2 0 432V346.1z"></path></svg><!-- <i class="fas fa-database"></i> Font Awesome fontawesome.com --> Dữ Liệu Học Tập</h2>
                <button onclick="toggleTeacherPanel()" class="text-gray-500 hover:text-red-500 p-2"><svg class="svg-inline--fa fa-xmark fa-2x" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="xmark" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" data-fa-i2svg=""><path fill="currentColor" d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"></path></svg><!-- <i class="fas fa-times fa-2x"></i> Font Awesome fontawesome.com --></button>
            </div>
            
            <div class="mb-6">
                <div class="flex flex-wrap justify-between items-end mb-2 gap-2">
                    <h3 class="font-bold border-b pb-1">Bảng Điểm Tổng Hợp</h3>
                    <div class="flex flex-wrap gap-1">
                        <button onclick="clearLocalHistory()" class="bg-red-500 hover:bg-red-600 text-white px-2 py-2 rounded text-sm font-bold shadow" title="Xóa lịch sử trên máy này">
                            <svg class="svg-inline--fa fa-trash" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="trash" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"></path></svg><!-- <i class="fas fa-trash"></i> Font Awesome fontawesome.com --> Xóa
                        </button>
                        <button onclick="exportExcel('all')" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded text-sm font-bold shadow">
                            <svg class="svg-inline--fa fa-file-excel" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="file-excel" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" data-fa-i2svg=""><path fill="currentColor" d="M64 0C28.7 0 0 28.7 0 64V448c0 35.3 28.7 64 64 64H320c35.3 0 64-28.7 64-64V160H256c-17.7 0-32-14.3-32-32V0H64zM256 0V128H384L256 0zM155.7 250.2L192 302.1l36.3-51.9c7.6-10.9 22.6-13.5 33.4-5.9s13.5 22.6 5.9 33.4L221.3 344l46.4 66.2c7.6 10.9 5 25.8-5.9 33.4s-25.8 5-33.4-5.9L192 385.8l-36.3 51.9c-7.6 10.9-22.6 13.5-33.4 5.9s-13.5-22.6-5.9-33.4L162.7 344l-46.4-66.2c-7.6-10.9-5-25.8 5.9-33.4s25.8-5 33.4 5.9z"></path></svg><!-- <i class="fas fa-file-excel"></i> Font Awesome fontawesome.com --> Xuất Tất Cả
                        </button>
                    </div>
                </div>
                
                <div class="bg-gray-50 border rounded h-80 overflow-y-auto" id="teacher-table-container">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-gray-200 sticky top-0">
                            <tr>
                                <th class="p-2 border">Thời gian</th>
                                <th class="p-2 border">Lớp</th>
                                <th class="p-2 border">Họ Tên</th>
                                <th class="p-2 border text-right">Điểm</th>
                            </tr>
                        </thead>
                        <tbody id="data-log-body"><tr><td colspan="4" class="p-2 bg-yellow-50 text-yellow-800 font-bold text-center text-xs border-b">Nguồn: Cloud (Trực Tuyến) - Tổng số lượt: 3</td></tr>
                    <tr class="border-b hover:bg-gray-100">
                        <td class="p-2">08:51:10 5/2/2026</td>
                        <td class="p-2 font-bold">xs</td>
                        <td class="p-2">s</td>
                        <td class="p-2 text-right font-bold text-green-600">1/10</td>
                    </tr>
                
                    <tr class="border-b hover:bg-gray-100">
                        <td class="p-2">08:50:00 5/2/2026</td>
                        <td class="p-2 font-bold">s</td>
                        <td class="p-2">Sương</td>
                        <td class="p-2 text-right font-bold text-green-600">2/10</td>
                    </tr>
                
                    <tr class="border-b hover:bg-gray-100">
                        <td class="p-2">08:30:54 5/2/2026</td>
                        <td class="p-2 font-bold">B</td>
                        <td class="p-2">V</td>
                        <td class="p-2 text-right font-bold text-green-600">1/10</td>
                    </tr>
                </tbody>
                    </table>
                </div>
                <p class="text-xs text-gray-500 mt-1 italic">* Chế độ Offline: Dữ liệu được lưu trong trình duyệt của máy này.</p>
            </div>
            <!-- Đã xóa phần Đáp Án Chi Tiết ở đây -->
        </div>
    </div>

    <!-- LOGIC JS -->
    <script>
        // --- CẤU HÌNH & DATA ---
        const NODE_POSITIONS = {
            1: { top: '35%', left: '15%' },
            2: { top: '70%', left: '35%' },
            3: { top: '30%', left: '65%' },
            4: { top: '55%', left: '75%' }
        };

        const QUESTIONS_DB = {
            round1: [
                { id: "r1_s1_q1", excelTitle: "Câu 1 T1", type: "mc", stage: 1, tag: "NB", points: 1, q: "Hai vectơ được gọi là cùng phương nếu giá của chúng:", opts: ["A. Cắt nhau", "B. Vuông góc", "C. Song song hoặc trùng nhau", "D. Trùng nhau"], ans: 2, exp: "Định nghĩa: Hai vectơ cùng phương là hai vectơ có giá song song hoặc trùng nhau." },
                { id: "r1_s1_q2", excelTitle: "Câu 2 T1", type: "mc", stage: 1, tag: "NB", points: 1, q: "Hai vectơ bằng nhau là hai vectơ có:", opts: ["A. Cùng hướng và cùng độ dài", "B. Cùng phương và cùng độ dài", "C. Cùng độ dài", "D. Cùng hướng"], ans: 0, exp: "Định nghĩa: Hai vectơ bằng nhau nếu chúng cùng hướng và cùng độ dài." },
                { id: "r1_s1_q3", excelTitle: "Câu 3 T1", type: "mc", stage: 1, tag: "NB", points: 1, q: "Khẳng định nào sau đây đúng về vectơ-không?", opts: ["A. Cùng hướng với mọi vectơ", "B. Khác phương với mọi vectơ", "C. Có độ dài bằng 1", "D. Có điểm đầu khác điểm cuối"], ans: 0, exp: "Vectơ-không cùng phương, cùng hướng với mọi vectơ và có độ dài bằng 0." },
                { id: "r1_s2_q1", excelTitle: "Câu 1 T2", type: "mc", stage: 2, tag: "VDT", points: 1, q: "Cho 3 điểm A, B, C bất kỳ. Đẳng thức nào sau đây đúng (Quy tắc 3 điểm)?", opts: ["A. <span class='vect'>AB</span> + <span class='vect'>AC</span> = <span class='vect'>BC</span>", "B. <span class='vect'>AB</span> + <span class='vect'>BC</span> = <span class='vect'>AC</span>", "C. <span class='vect'>AB</span> - <span class='vect'>AC</span> = <span class='vect'>BC</span>", "D. <span class='vect'>AB</span> = <span class='vect'>CB</span>"], ans: 1, exp: "Quy tắc 3 điểm (phép cộng): <span class='vect'>AB</span> + <span class='vect'>BC</span> = <span class='vect'>AC</span>." },
                { id: "r1_s2_q2", excelTitle: "Câu 2 T2", type: "mc", stage: 2, tag: "VDT", points: 1, q: "Quy tắc hiệu: Với 3 điểm O, A, B bất kỳ, <span class='vect'>OB</span> - <span class='vect'>OA</span> bằng:", opts: ["A. <span class='vect'>AB</span>", "B. <span class='vect'>BA</span>", "C. <span class='vect'>OA</span>", "D. <span class='vect'>BO</span>"], ans: 0, exp: "Quy tắc phép trừ: <span class='vect'>OB</span> - <span class='vect'>OA</span> = <span class='vect'>AB</span>." },
                { id: "r1_s2_q3", excelTitle: "Câu 3 T2", type: "mc", stage: 2, tag: "VDT", points: 1, q: "Cho hình bình hành ABCD. Tổng <span class='vect'>AB</span> + <span class='vect'>AD</span> bằng:", opts: ["A. <span class='vect'>CA</span>", "B. <span class='vect'>BD</span>", "C. <span class='vect'>AC</span>", "D. <span class='vect'>DB</span>"], ans: 2, exp: "Quy tắc hình bình hành: <span class='vect'>AB</span> + <span class='vect'>AD</span> = <span class='vect'>AC</span> (đường chéo xuất phát từ đỉnh chung)." },
                { 
                    id: "r1_s3_group", 
                    excelTitlePrefix: "Câu", 
                    excelTitleSuffix: "T3",
                    type: "group_tf", 
                    stage: 3, 
                    tag: "TH", 
                    points: 2, 
                    q: "Cho hình vuông ABCD có cạnh a, tâm O. Chọn đúng, sai cho từng ý sau (mỗi ý 0.5đ):", 
                    items: [
                        { text: "(a) Vectơ <span class='vect'>AD</span> có độ dài bằng a", ans: 0, subId: "a" }, // Đúng
                        { text: "(b) Hai vectơ <span class='vect'>AO</span>, <span class='vect'>CA</span> cùng phương", ans: 0, subId: "b" }, // Đúng
                        { text: "(c) Hai vectơ <span class='vect'>AB</span>, <span class='vect'>DC</span> là hai vectơ đối nhau", ans: 1, subId: "c" }, // Sai (bằng nhau)
                        { text: "(d) Có 1 vectơ khác vectơ <span class='vect'>0</span> có điểm đầu và điểm cuối lấy từ 5 điểm A, B, C, D, O và cùng hướng với vectơ <span class='vect'>OC</span>", ans: 1, subId: "d" } // Sai (có 2: AO, AC)
                    ],
                    exp: "Giải thích chi tiết:<br>a) Đúng. Cạnh hình vuông là a.<br>b) Đúng. A, O, C thẳng hàng nên giá trùng nhau.<br>c) Sai. <span class='vect'>AB</span> = <span class='vect'>DC</span> (cùng hướng, cùng độ dài), không phải đối nhau.<br>d) Sai. Các vectơ cùng hướng với <span class='vect'>OC</span> là <span class='vect'>AO</span> và <span class='vect'>AC</span> (Có 2 vectơ)."
                },
                { 
                    id: "r1_s4_q1", 
                    excelTitle: "Câu 1 T4",
                    type: "input", 
                    stage: 4, 
                    tag: "VDC", 
                    points: 1, 
                    q: "Cho hình chữ nhật ABCD có cạnh AB = 3, AD = 4. Tính <br>|<span class='vect'>AB</span> + <span class='vect'>AD</span>|. (Làm tròn kết quả đến hàng đơn vị).", 
                    opts: [], 
                    ans: "5", 
                    exp: "Áp dụng quy tắc hình bình hành: <span class='vect'>AB</span> + <span class='vect'>AD</span> = <span class='vect'>AC</span> (đường chéo hình chữ nhật).<br>Độ dài |<span class='vect'>AC</span>| = <span class='math-type'>&radic;<span style='border-top:1px solid; padding-left:1px'>AB² + AD²</span></span> = <span class='math-type'>&radic;<span style='border-top:1px solid; padding-left:1px'>3² + 4²</span></span> = <span class='math-type'>&radic;<span style='border-top:1px solid; padding-left:1px'>25</span></span> = 5." 
                },
                { 
                    id: "r1_s4_q2", 
                    excelTitle: "Câu 2 T4",
                    type: "input", 
                    stage: 4, 
                    tag: "VDC", 
                    points: 1, 
                    q: "Một con thuyền có vận tốc đối với nước là v₁ = 3 (m/s) và mũi thuyền hướng thẳng sang bờ bên kia. Dòng nước chảy đối với bờ với vận tốc là v₂ = 4 (m/s), vuông góc với hướng mũi thuyền. Tính độ lớn vận tốc thực tế của thuyền so với bờ (m/s).", 
                    opts: [], 
                    ans: "5", 
                    exp: "Gọi v₁ là vận tốc thuyền so với nước, v₂ là vận tốc nước so với bờ.<br>Vận tốc thực tế: <span class='vect'>v</span> = <span class='vect'>v₁</span> + <span class='vect'>v₂</span>.<br>Vì hai vectơ vuông góc nhau nên độ lớn: <br>v = <span class='math-type'>&radic;<span style='border-top:1px solid; padding-left:1px'>v₁² + v₂²</span></span> = <span class='math-type'>&radic;<span style='border-top:1px solid; padding-left:1px'>3² + 4²</span></span> = <span class='math-type'>&radic;<span style='border-top:1px solid; padding-left:1px'>25</span></span> = 5 (m/s)." 
                }
            ]
        };
        
        const STAGE_IMAGES = {
            1: "https://yt3.ggpht.com/UEPzGUr8PNahyh7Tbi__vMQjpJQnzMonJRDyFXZvY8yrRABoEbFxiGRtdqWAueS_wGYPV3czKYF3=s800-c-fcrop64=1,3a2e0000c5d1ffff-rw-nd-v1",
            2: "https://yt3.ggpht.com/03sVv970v2tE6V3aDd63x1F_Ugop1dRf2iq4I60vjHNUsUDXppyXiJTQ9gD-1WzlgzCwPFnWXqAyuQ=s800-c-fcrop64=1,3a2e0000c5d1ffff-rw-nd-v1",
            3: "https://yt3.ggpht.com/IQ0wUC1F3NtdCDqCyb-iKdeaQTXOm7u1DRMTqjc8B65eZXZpgdl9aZIml0zsRWQtqlPZa0AwVthqwIE=s800-c-fcrop64=1,00002aabffffd555-rw-nd-v1",
            4: "https://yt3.ggpht.com/v-gl1O97-eKlcPotcLdr6owy40M03uiS9XaL5tVNaEXGeTTSirGZqrIhSzs7nLitRZOMtShyGGcf=s800-c-fcrop64=1,49b20000b64dffff-rw-nd-v1"
        };

        let state = {
            round: 1,
            score: 0,
            user: { name: "", class: "" },
            currentStageId: 0, 
            currentQIndex: 0,
            stageQuestions: [],
            wrongAnswers: [], 
            history: [],
            completedStages: [], 
            failedCurrentQ: false,
            introVideoUrl: null
        };

        let audio = {
            bg: null,
            correct: null,
            wrong: null,
            win: null,
            travel: null
        };

        let teacherData = []; 
        let isOnline = false;

        // Hooks for Cloud Sync
        window.syncToCloudHook = async (data) => { console.log("Offline Save:", data); };
        window.loadFromCloudHook = (callback) => { console.log("Offline Load"); };

        window.onload = function() {
            audio.bg = document.getElementById('bg-music');
            audio.correct = document.getElementById('sfx-correct');
            audio.wrong = document.getElementById('sfx-wrong');
            audio.win = document.getElementById('sfx-win');
            audio.travel = document.getElementById('sfx-travel');
            
            if(audio.bg) audio.bg.volume = 0.2;
            
            document.getElementById('screen-login').classList.remove('hidden');
            const bgAudio = document.getElementById('bg-music');
            if (bgAudio.getAttribute('src') && bgAudio.getAttribute('src').startsWith('data:')) {
                document.getElementById('music-icon').className = 'fas fa-volume-up';
                const btn = document.getElementById('btn-upload-music');
                if(btn) btn.innerHTML = '<i class="fas fa-check"></i> Nhạc (Đã lưu)';
            }
        };

        function showStory(text) {
            const storyBox = document.getElementById('story-box');
            const storyText = document.getElementById('story-text');
            storyText.innerText = text;
            storyBox.classList.remove('hidden');
        }

        function saveGameResult() {
            let detailsMap = {};
            state.history.forEach(h => {
                if (h.excelHeader) {
                    detailsMap[h.excelHeader] = h.correct ? "Đ" : "S";
                }
            });

            const resultData = {
                name: state.user.name,
                class: state.user.class,
                score: state.score,
                round: state.round,
                timestamp: new Date().toISOString(),
                ...detailsMap
            };

            // 1. Luôn lưu LocalStorage (cho offline)
            try {
                const localHistory = JSON.parse(localStorage.getItem('vecto_game_history') || '[]');
                localHistory.push(resultData);
                localStorage.setItem('vecto_game_history', JSON.stringify(localHistory));
            } catch (e) {
                console.error("Lỗi lưu LocalStorage:", e);
            }

            // 2. Thử lưu Cloud
            if (typeof window.syncToCloudHook === 'function') {
                window.syncToCloudHook(resultData);
            }
        }

        function enterGameWorld() {
            document.getElementById('screen-mission').classList.add('hidden'); // Ẩn màn hình nhiệm vụ
            document.getElementById('screen-map').classList.remove('hidden');
            if(audio.bg) audio.bg.play().catch(()=>{});
            moveCharacter(1);
            showStory("Bản đồ đã mở! Thuyền trưởng có thể chọn bất kỳ hòn đảo nào để thám hiểm.");
        }
        
        // Hàm mới: Hiển thị màn hình nhiệm vụ
        window.showMissionScreen = function() {
            document.getElementById('screen-mission').classList.remove('hidden');
        };

        // Hàm mới: Đóng màn hình nhiệm vụ và vào map
        window.closeMissionScreen = function() {
            enterGameWorld();
        };

        window.startGame = function() {
            const name = document.getElementById('input-name').value.trim();
            const cls = document.getElementById('input-class').value.trim();
            if (!name || !cls) {
                alert("Vui lòng nhập tên và lớp!");
                return;
            }
            state.user.name = name;
            state.user.class = cls;
            state.completedStages = [];
            
            document.getElementById('display-name').innerText = name;
            document.getElementById('display-class').innerText = cls;
            document.getElementById('screen-login').classList.add('hidden');
            
            const introVid = document.getElementById('intro-video-element');
            const hasVideo = (state.introVideoUrl) || (introVid.getAttribute('src') && introVid.getAttribute('src').length > 50);

            if (hasVideo) {
                playIntroVideo();
            } else {
                showMissionScreen(); // Vào màn hình nhiệm vụ thay vì vào map ngay
            }
        };

        function playIntroVideo() {
            const modal = document.getElementById('video-intro-modal');
            const vid = document.getElementById('intro-video-element');
            const skipBtn = document.getElementById('skip-video-btn');
            const manualBtn = document.getElementById('manual-play-overlay');
            const manualClickBtn = document.getElementById('manual-play-btn');

            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            vid.currentTime = 0;
            
            vid.play().catch(e => {
                console.log("Autoplay blocked, showing manual play button");
                manualBtn.classList.remove('hidden');
                manualClickBtn.onclick = () => {
                    vid.play();
                    manualBtn.classList.add('hidden');
                };
            });

            const finishVideo = () => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                vid.pause();
                vid.removeEventListener('ended', finishVideo);
                skipBtn.onclick = null;
                showMissionScreen(); // Chuyển sang màn hình nhiệm vụ sau khi xem video
            };

            vid.addEventListener('ended', finishVideo);
            skipBtn.onclick = finishVideo;
        }

        window.moveCharacter = function(stageNum) {
            const char = document.getElementById('player-character');
            const pos = NODE_POSITIONS[stageNum];
            if (pos && char) {
                char.style.top = pos.top;
                char.style.left = pos.left;
            }
        };

        window.enterStage = function(stageNum) {
            if (state.completedStages.includes(stageNum)) {
                showStory("Trạm này đã hoàn thành! Hãy tìm kho báu ở trạm khác.");
                return;
            }

            state.currentStageId = stageNum;
            moveCharacter(stageNum);
            const db = QUESTIONS_DB.round1;
            
            state.stageQuestions = db.filter(q => (q.stage || 0) === stageNum || (stageNum === 1 && q.id.includes("s1")) || (stageNum === 2 && q.id.includes("s2")) || (stageNum === 3 && q.id.includes("s3")) || (stageNum === 4 && q.id.includes("s4")));
            
            if (state.stageQuestions.length === 0) {
                 let prefix = "r1_s" + stageNum;
                 state.stageQuestions = db.filter(q => q.id.includes(prefix));
            }
            showStageIntro(stageNum, () => {
                state.currentQIndex = 0;
                showQuestionModal();
            });
        };

        function showStageIntro(stageNum, callback) {
            const modal = document.getElementById('stage-intro-modal');
            const img = document.getElementById('stage-intro-img');
            const text = document.getElementById('stage-intro-text');
            img.src = STAGE_IMAGES[stageNum];
            text.innerText = `Cửa Ải ${stageNum}`;
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            if(audio.travel) audio.travel.play().catch(()=>{});
            setTimeout(() => {
                modal.classList.add('opacity-0'); 
                setTimeout(() => {
                    modal.classList.remove('flex');
                    modal.classList.add('hidden');
                    modal.classList.remove('opacity-0'); 
                    if (callback) callback();
                }, 500); 
            }, 2000); 
        }

        function showQuestionModal() {
            state.failedCurrentQ = false; 
            const q = state.stageQuestions[state.currentQIndex];
            if (!q) {
                finishStage();
                return;
            }

            const modal = document.getElementById('modal-question');
            modal.classList.remove('hidden');
            modal.classList.add('flex');

            const modalInner = modal.querySelector('.parchment-modal');
            modalInner.className = "parchment-modal w-full max-w-3xl mx-4 p-8 relative shadow-2xl animate-fade-in-up";

            // Cập nhật: Nếu là Trạm 3, giảm padding và margin để tăng chiều rộng nội dung trên mobile
            if (state.currentStageId === 3) {
                modalInner.classList.remove('p-8');
                modalInner.classList.add('p-2', 'md:p-8'); // Giảm padding trên mobile
                modalInner.classList.remove('mx-4');
                modalInner.classList.add('mx-1', 'md:mx-4'); // Giảm margin bên ngoài
            }
            
            document.getElementById('q-title').innerText = `Cửa Ải ${state.currentStageId}`;
            document.getElementById('q-progress').innerText = `${state.currentQIndex + 1}/${state.stageQuestions.length}`;
            document.getElementById('q-content').innerHTML = q.q;
            
            const feedback = document.getElementById('q-feedback');
            feedback.classList.add('hidden');
            feedback.classList.remove('flex');
            feedback.className = "hidden flex-grow p-4 rounded-lg text-center border-2 shadow-inner w-full";
            
            document.getElementById('q-explanation').classList.add('hidden');
            document.getElementById('btn-next-q').classList.add('hidden');

            const optsContainer = document.getElementById('q-options');
            optsContainer.innerHTML = '';
            
            if ((state.currentStageId === 1 || state.currentStageId === 2) && (q.type === 'mc' || q.type === 'tf')) {
                optsContainer.className = "grid grid-cols-2 gap-3"; 
            } else {
                optsContainer.className = "grid grid-cols-1 gap-3"; 
            }

            if (q.type === 'group_tf') {
                const table = document.createElement('table');
                table.className = 'q-table';
                
                const thead = document.createElement('thead');
                thead.innerHTML = `<tr><th style="width: 70%">Nội dung</th><th style="width: 15%">Đúng</th><th style="width: 15%">Sai</th></tr>`;
                table.appendChild(thead);

                const tbody = document.createElement('tbody');
                q.items.forEach((item, idx) => {
                    const row = document.createElement('tr');
                    row.id = `row-${idx}`;
                    row.innerHTML = `
                        <td>${item.text}</td>
                        <td class="text-center"><input type="radio" name="g_opt_${idx}" value="0" class="radio-custom" id="radio-${idx}-0"></td>
                        <td class="text-center"><input type="radio" name="g_opt_${idx}" value="1" class="radio-custom" id="radio-${idx}-1"></td>
                    `;
                    tbody.appendChild(row);
                });
                table.appendChild(tbody);
                optsContainer.appendChild(table);

                const btn = document.createElement('button');
                btn.className = "mt-4 w-full bg-yellow-700 text-white py-2 rounded-lg hover:bg-yellow-800 font-bold text-lg uppercase shadow-md";
                btn.innerText = "Xác nhận (Chỉ 1 lần)";
                btn.onclick = () => checkGroupAnswer();
                optsContainer.appendChild(btn);
            } 
            else if (q.type === 'mc' || q.type === 'tf') {
                q.opts.forEach((opt, idx) => {
                    const btn = document.createElement('button');
                    btn.className = "w-full text-left p-3 rounded-lg shadow-sm option-btn text-base relative";
                    btn.innerHTML = opt;
                    btn.dataset.index = idx; 
                    btn.onclick = () => checkAnswer(idx, btn);
                    optsContainer.appendChild(btn);
                });
            } else if (q.type === 'input') {
                const wrapper = document.createElement('div');
                wrapper.className = "flex flex-col items-center gap-3"; 
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'w-full max-w-md p-2 border-2 border-yellow-600 rounded-lg outline-none focus:border-blue-600 text-lg bg-yellow-50 text-center font-bold';
                input.placeholder = 'Nhập đáp án (VD: 100)...';
                input.id = 'input-answer';
                input.onkeypress = function(e){ if(e.keyCode === 13) checkInputAnswer(); };
                
                const btn = document.createElement('button');
                btn.className = "bg-yellow-700 text-white px-6 py-2 rounded-lg hover:bg-yellow-800 font-bold text-base uppercase shadow-md transition-transform transform hover:scale-105";
                btn.innerText = "Kiểm Tra (Chỉ 1 lần)";
                btn.onclick = () => checkInputAnswer();
                wrapper.appendChild(input);
                wrapper.appendChild(btn);
                optsContainer.appendChild(wrapper);
            }
        }

        window.checkGroupAnswer = function() {
            const confirmBtn = document.querySelector('#q-options button');
            if (confirmBtn.disabled) return;
            confirmBtn.disabled = true;

            const currentQ = state.stageQuestions[state.currentQIndex];
            const radios = document.querySelectorAll('.radio-custom');
            let allChecked = true;
            let correctCount = 0;
            let userAnswers = [];

            for (let i = 0; i < currentQ.items.length; i++) {
                const checked = document.querySelector(`input[name="g_opt_${i}"]:checked`);
                if (!checked) { allChecked = false; break; }
                userAnswers.push(parseInt(checked.value));
            }

            if (!allChecked) { 
                alert("Vui lòng chọn Đúng/Sai cho tất cả các ý!"); 
                confirmBtn.disabled = false;
                return; 
            }

            radios.forEach(r => r.disabled = true);

            currentQ.items.forEach((item, idx) => {
                const isItemCorrect = userAnswers[idx] === item.ans;
                const row = document.getElementById(`row-${idx}`);
                
                state.history.push({ 
                    qId: currentQ.id + "_" + item.subId, 
                    excelHeader: `Câu ${item.subId} ${currentQ.excelTitleSuffix}`,
                    correct: isItemCorrect, 
                    round: state.round 
                });

                if (isItemCorrect) {
                    correctCount++;
                    row.classList.add('row-correct');
                    row.querySelector('td:first-child').innerHTML += ' <i class="fas fa-check text-green-600"></i>';
                } else {
                    row.classList.add('row-wrong');
                    row.querySelector('td:first-child').innerHTML += ' <i class="fas fa-times text-red-600"></i>';
                    const correctRadioId = `radio-${idx}-${item.ans}`;
                    document.getElementById(correctRadioId).parentElement.style.backgroundColor = "#86efac"; 
                }
            });

            const feedbackBox = document.getElementById('q-feedback');
            const feedbackText = document.getElementById('q-feedback-text');
            const expText = document.getElementById('q-explanation');
            
            feedbackBox.classList.remove('hidden');
            feedbackBox.classList.add('flex');
            
            const pointsPerItem = (currentQ.points || 0) / currentQ.items.length;
            const gainedPoints = correctCount * pointsPerItem;

            if (!state.failedCurrentQ) {
                state.score += gainedPoints;
                state.score = parseFloat(state.score.toFixed(2));
            }

            if (correctCount === currentQ.items.length) {
                if(audio.correct){ audio.correct.currentTime = 0; audio.correct.play().catch(()=>{}); }
                if(window.confetti) {
                    confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors: ['#48bb78', '#f6e05e', '#ffffff'] });
                }
                feedbackBox.classList.add('bg-green-100', 'text-green-800', 'border-green-300');
                feedbackText.innerHTML = `<i class="fas fa-check-circle text-2xl mb-1"></i> TUYỆT VỜI! (+${gainedPoints}đ)`;
            } else if (correctCount > 0) {
                if(audio.wrong){ audio.wrong.currentTime = 0; audio.wrong.play().catch(()=>{}); }
                state.failedCurrentQ = true;
                feedbackBox.classList.add('bg-orange-100', 'text-orange-800', 'border-orange-300');
                feedbackText.innerHTML = `<i class="fas fa-exclamation-circle text-2xl mb-1"></i> Khá tốt! Bạn đúng ${correctCount}/${currentQ.items.length} ý. (+${gainedPoints}đ)`;
                state.wrongAnswers.push(currentQ);
            } else {
                if(audio.wrong){ audio.wrong.currentTime = 0; audio.wrong.play().catch(()=>{}); }
                state.failedCurrentQ = true;
                feedbackBox.classList.add('bg-red-100', 'text-red-800', 'border-red-300');
                feedbackText.innerHTML = `<i class="fas fa-times-circle text-2xl mb-1"></i> Tiếc quá! Chưa đúng ý nào.`;
                state.wrongAnswers.push(currentQ);
            }

            document.getElementById('score-display').innerText = state.score;
            if (currentQ.exp) {
                expText.innerHTML = `<strong>Giải thích:</strong> ${currentQ.exp}`;
                expText.classList.remove('hidden');
            }
            document.getElementById('btn-next-q').classList.remove('hidden');
            feedbackBox.scrollIntoView({behavior: "smooth"});
        };

        window.checkInputAnswer = function() {
            const inputEl = document.getElementById('input-answer');
            if (inputEl.disabled) return;
            const submitBtn = inputEl.nextElementSibling;
            if(submitBtn.disabled) return;
            
            submitBtn.disabled = true;
            inputEl.disabled = true;

            const inputVal = inputEl.value.toLowerCase().trim().replace(/\s+/g, ' '); 
            const currentQ = state.stageQuestions[state.currentQIndex];
            let isCorrect = false;
            if (Array.isArray(currentQ.ans)) {
                isCorrect = currentQ.ans.some(a => inputVal.includes(a.toLowerCase()));
            } else {
                isCorrect = inputVal === currentQ.ans.toLowerCase();
            }
            if (isCorrect) handleCorrect(currentQ, submitBtn, inputEl);
            else handleWrong(currentQ, submitBtn, inputEl);
        };

        window.checkAnswer = function(selectedIndex, btnElement) {
            if (btnElement.disabled) return; 
            const allBtns = document.querySelectorAll('.option-btn');
            allBtns.forEach(b => b.disabled = true);

            const currentQ = state.stageQuestions[state.currentQIndex];
            if (selectedIndex === currentQ.ans) handleCorrect(currentQ, btnElement);
            else handleWrong(currentQ, btnElement);
        };

        function handleCorrect(currentQ, visualElement, inputElement = null) {
            if(audio.correct){ audio.correct.currentTime = 0; audio.correct.play().catch(()=>{}); }
            
            if (visualElement) visualElement.classList.add('correct-answer', 'animate-pop');
            if (inputElement) inputElement.classList.add('border-green-500', 'bg-green-100', 'animate-pop');

            if(window.confetti) {
                confetti({ particleCount: 60, spread: 60, origin: { y: 0.7 }, colors: ['#48bb78', '#f6e05e', '#ffffff'], disableForReducedMotion: true });
            }

            const feedbackBox = document.getElementById('q-feedback');
            const feedbackText = document.getElementById('q-feedback-text');
            const expText = document.getElementById('q-explanation');

            feedbackBox.classList.remove('hidden');
            feedbackBox.classList.add('flex'); 
            feedbackBox.classList.remove('bg-red-100', 'text-red-800', 'border-red-300');
            feedbackBox.classList.add('bg-green-100', 'text-green-800', 'border-green-300');
            feedbackText.innerHTML = `<i class="fas fa-check-circle text-2xl mb-1"></i> CHÍNH XÁC! (+${currentQ.points || 1}đ)`;
            
            if (currentQ.exp) {
                expText.innerHTML = `<strong>Giải thích:</strong> ${currentQ.exp}`;
                expText.classList.remove('hidden');
            }
            document.getElementById('btn-next-q').classList.remove('hidden');
            feedbackBox.scrollIntoView({behavior: "smooth"});

            if (!state.failedCurrentQ) {
                state.score += (currentQ.points || 1);
                state.score = parseFloat(state.score.toFixed(2));
            }
            document.getElementById('score-display').innerText = state.score;
            
            state.history.push({ qId: currentQ.id, excelHeader: currentQ.excelTitle, correct: true, round: state.round });
        }

        function handleWrong(currentQ, visualElement, inputElement = null) {
            if(audio.wrong){ audio.wrong.currentTime = 0; audio.wrong.play().catch(()=>{}); }

            state.failedCurrentQ = true; 
            if (!state.wrongAnswers.find(w => w.id === currentQ.id)) state.wrongAnswers.push(currentQ);

            if (visualElement) {
                visualElement.classList.add('wrong-answer');
                if (inputElement) {
                    visualElement.classList.remove('wrong-answer'); 
                    inputElement.classList.add('border-red-500', 'bg-red-50');
                }
            }
            if (currentQ.type === 'mc' || currentQ.type === 'tf') {
                const correctBtn = document.querySelector(`.option-btn[data-index='${currentQ.ans}']`);
                if (correctBtn) {
                    correctBtn.classList.add('correct-answer');
                    correctBtn.innerHTML += ' <i class="fas fa-check-circle float-right"></i>';
                }
            }
            const feedbackBox = document.getElementById('q-feedback');
            const feedbackText = document.getElementById('q-feedback-text');
            const expText = document.getElementById('q-explanation');
            feedbackBox.classList.remove('hidden');
            feedbackBox.classList.add('flex'); 
            feedbackBox.classList.add('bg-red-100', 'text-red-800', 'border-red-300');
            feedbackText.innerHTML = `<i class="fas fa-times-circle text-2xl mb-1"></i> SAI RỒI!`;
            if (currentQ.exp) {
                expText.innerHTML = `<strong>Giải thích:</strong> ${currentQ.exp}`;
                expText.classList.remove('hidden');
            }
            document.getElementById('btn-next-q').classList.remove('hidden');
            feedbackBox.scrollIntoView({behavior: "smooth"});
            
            state.history.push({ qId: currentQ.id, excelHeader: currentQ.excelTitle, correct: false, round: state.round });
        }

        window.nextQuestion = function() {
            state.currentQIndex++;
            showQuestionModal();
        };

        function finishStage() {
            document.getElementById('modal-question').classList.add('hidden');
            document.getElementById('modal-question').classList.remove('flex');
            
            if (!state.completedStages.includes(state.currentStageId)) {
                state.completedStages.push(state.currentStageId);
                const currentNode = document.getElementById(`node-${state.currentStageId}`);
                currentNode.classList.add('stage-completed');
                const checkMark = currentNode.querySelector('.check-mark');
                if(checkMark) checkMark.classList.remove('hidden');
                document.getElementById('stages-completed-count').innerText = state.completedStages.length;
            }

            if (state.completedStages.length >= 4) {
                finishRound();
            } else {
                showStory("Bạn đã hoàn thành khu vực này. Hãy chọn hòn đảo tiếp theo!");
            }
        }

        function finishRound() {
            document.getElementById('screen-map').classList.add('hidden');
            document.getElementById('screen-result').classList.remove('hidden');
            document.getElementById('screen-result').classList.add('flex');
            if(audio.win) audio.win.play().catch(()=>{});
            
            saveGameResult(); 
            
            document.getElementById('live-indicator').classList.remove('hidden');

            document.getElementById('result-r1').classList.remove('hidden');
            document.getElementById('final-score-r1').innerText = state.score;
            
            let title = "", msg = "", reward = "", icon = "";
            if (state.score >= 10) {
                title = "VUA HẢI TẶC VECTƠ"; msg = "Đẳng cấp!"; reward = "Thẻ bài 'Quyền Lực Tối Thượng'"; icon = "👑";
                if(window.confetti) confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            } else if (state.score >= 8) {
                title = "THUYỀN PHÓ TÀI BA"; msg = "Kỹ năng tuyệt vời!"; reward = "Thẻ 'Trợ Thủ Đắc Lực'"; icon = "⚓";
                if(window.confetti) confetti({ particleCount: 100, spread: 60 });
            } else if (state.score >= 5) {
                title = "THỦY THỦ TẬP SỰ"; msg = "Cần rèn luyện thêm."; reward = "1 Viên Kẹo Năng Lượng"; icon = "⛵";
            } else {
                title = "THỦY THỦ CẦN CỨU HỘ"; msg = "Tín hiệu S.O.S!"; reward = "Đội cứu hộ đang đến!"; icon = "🆘";
            }
            document.getElementById('badge-title').innerText = title;
            document.getElementById('badge-msg').innerText = msg;
            document.getElementById('badge-reward').innerText = reward;
            document.getElementById('badge-icon').innerText = icon;
        }

        window.closeStory = function() {
            document.getElementById('story-box').classList.add('hidden');
        };
        
        window.closeModal = function() {
            document.getElementById('modal-question').classList.remove('flex');
            document.getElementById('modal-question').classList.add('hidden');
        };

        window.downloadGame = function() {
            const btn = document.getElementById('btn-download-game');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang đóng gói...';
            btn.disabled = true;

            const introVid = document.getElementById('intro-video-element');
            if (state.introVideoUrl) {
                introVid.setAttribute('src', state.introVideoUrl);
            } else if (introVid.src && introVid.src.startsWith('data:')) {
                introVid.setAttribute('src', introVid.src);
            }

            const bgMusic = document.getElementById('bg-music');
            if (bgMusic.src && bgMusic.src.startsWith('data:')) {
                bgMusic.setAttribute('src', bgMusic.src);
            }

            setTimeout(() => {
                try {
                    const htmlContent = document.documentElement.outerHTML;
                    const blob = new Blob([htmlContent], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    
                    const d = new Date();
                    const timeStr = `${d.getHours()}h${d.getMinutes()}`;
                    a.download = `TroChoiVecto_Full_${timeStr}.html`;
                    
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                } catch (e) {
                    alert("Lỗi: Không thể tải xuống.");
                }
                btn.innerHTML = originalText;
                btn.disabled = false;
            }, 500); 
        };

        window.uploadMusic = function(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    const base64Audio = e.target.result;
                    const bgAudio = document.getElementById('bg-music');
                    bgAudio.src = base64Audio;
                    bgAudio.load();
                    document.getElementById('btn-upload-music').innerHTML = '<i class="fas fa-check"></i> Nhạc (Đã lưu)';
                };
                reader.readAsDataURL(file);
            }
        };

        window.uploadIntroVideo = function(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    state.introVideoUrl = e.target.result;
                    const vidElement = document.getElementById('intro-video-element');
                    vidElement.src = state.introVideoUrl;
                    document.getElementById('btn-upload-video').innerHTML = '<i class="fas fa-check"></i> Video (Đã lưu)';
                };
                reader.readAsDataURL(file);
            }
        };

        window.adjustVolume = function(val) {
            if(audio.bg) audio.bg.volume = parseFloat(val);
        };

        window.toggleMusic = function() {
            if(audio.bg) {
                if (audio.bg.paused) {
                    audio.bg.play().catch(()=>{});
                    document.getElementById('music-icon').className = 'fas fa-volume-up';
                } else {
                    audio.bg.pause();
                    document.getElementById('music-icon').className = 'fas fa-volume-mute';
                }
            }
        };

        window.toggleTeacherPanel = function() {
            const panel = document.getElementById('teacher-panel');
            const isOpen = panel.classList.contains('translate-x-full');
            
            if (isOpen) {
                panel.classList.remove('translate-x-full');
                // Đã xóa hàm renderSolutions() ở đây
                
                if (typeof window.loadFromCloudHook === 'function') {
                    window.loadFromCloudHook((data, source) => {
                         renderTeacherTable(data, source);
                    });
                }
                
                if (!isOnline) {
                    loadLocalData();
                }

            } else {
                panel.classList.add('translate-x-full');
                if (window.stopCloudSyncHook) window.stopCloudSyncHook();
            }
        };

        function loadLocalData() {
            try {
                const localHistory = JSON.parse(localStorage.getItem('vecto_game_history') || '[]');
                teacherData = localHistory.map(item => ({
                    ...item,
                    displayTime: item.timestamp ? new Date(item.timestamp).toLocaleString('vi-VN') : 'N/A'
                }));
                teacherData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                renderTeacherTable(teacherData, "Máy Cục Bộ (Offline)");
            } catch(e) {
                console.error(e);
                document.getElementById('data-log-body').innerHTML = '<tr><td colspan="4" class="p-4 text-center text-red-500">Lỗi đọc dữ liệu offline.</td></tr>';
            }
        }

        function renderTeacherTable(data, source) {
            teacherData = data;
            const tbody = document.getElementById('data-log-body');
            tbody.innerHTML = '';
            const headerRow = `<tr><td colspan="4" class="p-2 bg-yellow-50 text-yellow-800 font-bold text-center text-xs border-b">Nguồn: ${source} - Tổng số lượt: ${data.length}</td></tr>`;
            tbody.innerHTML += headerRow;

            if (data.length === 0) {
                tbody.innerHTML += '<tr><td colspan="4" class="p-4 text-center text-gray-500">Chưa có kết quả nào được lưu.</td></tr>';
                return;
            }
            data.forEach(item => {
                const row = `
                    <tr class="border-b hover:bg-gray-100">
                        <td class="p-2">${item.displayTime}</td>
                        <td class="p-2 font-bold">${item.class}</td>
                        <td class="p-2">${item.name}</td>
                        <td class="p-2 text-right font-bold text-green-600">${item.score}/10</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        window.clearLocalHistory = function() {
            if(confirm("Bạn có chắc muốn xóa toàn bộ lịch sử chơi trên máy này không?")) {
                localStorage.removeItem('vecto_game_history');
                loadLocalData(); 
            }
        };

        window.exportExcel = function(targetRound) {
            if (typeof XLSX === 'undefined') {
                alert("Lỗi: Thư viện xuất Excel chưa tải xong. Vui lòng kiểm tra kết nối mạng và thử lại.");
                return;
            }

            if (!teacherData || teacherData.length === 0) {
                alert("Chưa có dữ liệu để xuất!");
                return;
            }

            let dynamicHeaders = [];
            QUESTIONS_DB.round1.forEach(q => {
                if (q.excelTitle) dynamicHeaders.push(q.excelTitle);
                if (q.type === 'group_tf' && q.items) {
                    q.items.forEach(item => dynamicHeaders.push(`Câu ${item.subId} ${q.excelTitleSuffix}`));
                }
            });

            const excelData = teacherData.map(item => {
                let row = { "Thời Gian": item.displayTime, "Lớp": item.class, "Họ Tên": item.name, "Điểm Số": item.score };
                dynamicHeaders.forEach(header => {
                    row[header] = item[header] || ""; 
                });
                return row;
            });

            try {
                const ws = XLSX.utils.json_to_sheet(excelData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "KetQua_Vecto");
                XLSX.writeFile(wb, "Diem_Vong_1.xlsx");
            } catch (e) {
                alert("Lỗi khi tạo file Excel.");
            }
        };
        
        // Đã xóa hàm renderSolutions() khỏi cuối file script
    </script>

    <!-- MODULE CLOUD/FIREBASE -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        let db, auth, appId;
        let unsubscribe = null;

        try {
            if (typeof __firebase_config !== 'undefined') {
                const firebaseConfig = JSON.parse(__firebase_config);
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

                const initAuth = async () => {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }
                };

                initAuth().then(() => {
                    console.log("Connected to Cloud");
                    isOnline = true; 
                    const statusEl = document.getElementById('cloud-status');
                    if(statusEl) {
                         statusEl.innerHTML = '<i class="fas fa-wifi"></i> Online';
                         statusEl.className = "text-xs text-green-500 ml-2";
                    }

                    // --- Override Global Hooks ---
                    window.syncToCloudHook = async (data) => {
                        try {
                            if (!auth.currentUser) return;
                            const cloudData = { ...data, timestamp: serverTimestamp() };
                            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'game_results'), cloudData);
                            console.log("Synced to Cloud");
                        } catch(e) { console.error("Cloud Sync Error", e); }
                    };

                    window.loadFromCloudHook = (callback) => {
                        if (!auth.currentUser) return;
                        document.getElementById('live-indicator').classList.add('hidden');
                        document.getElementById('data-log-body').innerHTML = '<tr><td colspan="4" class="p-4 text-center"><i class="fas fa-spinner fa-spin"></i> Đang đồng bộ dữ liệu Cloud...</td></tr>';
                        
                        const q = collection(db, 'artifacts', appId, 'public', 'data', 'game_results');
                        unsubscribe = onSnapshot(q, (snapshot) => {
                            let cloudData = [];
                            snapshot.forEach((doc) => {
                                const d = doc.data();
                                d.displayTime = d.timestamp ? new Date(d.timestamp.seconds * 1000).toLocaleString('vi-VN') : 'N/A';
                                cloudData.push(d);
                            });
                            cloudData.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));
                            if(callback) callback(cloudData, "Cloud (Trực Tuyến)");
                        }, (error) => {
                            console.error("Cloud fetch error", error);
                        });
                    };
                    
                    window.stopCloudSyncHook = () => {
                        if(unsubscribe) { unsubscribe(); unsubscribe = null; }
                    };

                }).catch(e => {
                    console.warn("Offline Mode (Auth Failed):", e);
                });
            }
        } catch (e) {
            console.warn("Offline Mode (Module Error):", e);
        }
    </script>

</body></html>